RewriteEngine on
#RewriteBase %URI_PATH%
RewriteBase /
#RewriteBase /~roger/web/
#php_value error_log /home/roger/logs/php_error_log


# dont allow outside access to clear apc cache
RewriteCond %{HTTP_HOST} ^(.*\.)?(m|mobile|www)\.trulia\.com$
RewriteRule ^include/clear_apc_cache\.php$ / [QSA,L,R=301]

# redirect bots from stage to main
RewriteCond %{HTTP_USER_AGENT} Slurp [OR]
RewriteCond %{HTTP_USER_AGENT} Googlebot [OR]
RewriteCond %{HTTP_USER_AGENT} Yahoo [OR]
RewriteCond %{HTTP_USER_AGENT} Teoma [OR]
RewriteCond %{HTTP_USER_AGENT} Ask [OR]
RewriteCond %{HTTP_USER_AGENT} msn
RewriteCond %{REQUEST_URI} /stage/
RewriteRule (.*) http://www.trulia.com/ [R=301,L]

RewriteCond %{HTTP_USER_AGENT} Slurp [OR]
RewriteCond %{HTTP_USER_AGENT} Googlebot [OR]
RewriteCond %{HTTP_USER_AGENT} Yahoo [OR]
RewriteCond %{HTTP_USER_AGENT} Teoma [OR]
RewriteCond %{HTTP_USER_AGENT} Ask [OR]
RewriteCond %{HTTP_USER_AGENT} msn
RewriteCond %{HTTP_HOST} web[0-9]*.trulia.com
RewriteCond %{REQUEST_URI} !//SEARCH/.*
RewriteRule (.*) http://www.trulia.com/$1 [R=301,L]

# remove unpopulated template elements
RewriteRule (.*)/\{.+\}\/?$ $1/ [R=301,L]

#remove sort options from uris requested by search bots
RewriteCond %{HTTP_USER_AGENT} Googlebot [OR]
RewriteCond %{HTTP_USER_AGENT} Yahoo [OR]
RewriteCond %{HTTP_USER_AGENT} Teoma [OR]
RewriteCond %{HTTP_USER_AGENT} Ask [OR]
RewriteCond %{HTTP_USER_AGENT} msn
RewriteRule (.*)/sort_.* $1/ [R=301,L]

# Craigslist domain-hopping redirect
RewriteCond %{HTTP_HOST} ^listing\.truliaholic\.com [NC]
RewriteRule (.*) http://www.trulia.com/$1 [R=301,L]

#Send Manhattan requests to New York
RewriteRule ^NY/Manhattan(.*)$ NY/New_York$1 [L,R=301]

#submit feed typo
RewriteRule ^submitfeed(.*)$ submit_listings/ [L,R=301]
RewriteRule ^submit_feed(.*)$ submit_listings/ [L,R=301]

# redirect to www if no www
RewriteCond %{HTTP_HOST} ^trulia\.com$ [NC]
RewriteRule ^.*$ http://www.trulia.com%{REQUEST_URI} [L,R=301]

# robots for cobrands
RewriteCond %{HTTP_HOST} !^www\.trulia\.com [NC]
RewriteRule ^robots\.txt robots.php

#trailing null fix
RewriteRule ^(.*)null$ $1 [L,R=301]
#no trailing slash fix
RewriteRule ^([A-Za-z]{2})/(.*[^/])$ $1/$2/ [L,R=301]
RewriteRule ^(rss2/[A-Za-z]{2})/(.*[^/])$ $1/$2/ [L,R=301]
#RewriteRule ^(kml2/[A-Za-z]{2})/(.*[^/])$ $1/$2/ [L,R=301]
# redirect blank property/ URL to home page to take it out of Google
RewriteRule ^property\/?$ http://www.trulia.com/ [L,R=301]

#Remove when Barbie campaign is over - JF 2/5/2013
#See http://knowledge.corp.trulia.com/display/Engineering/Refactor+and+Clean+up+Tasks
#for all files that should be removed when this campaign ends
RewriteRule ^barbie$ barbie/ [L,R=301,NC]
RewriteRule ^barbie/$ barbie.html [L]
RewriteRule ^barbie/$ barbie/ [L,R=301,NC]


# submit search form
RewriteRule ^submit_search/?$ mvc_handler.php?dir=Search&controller=FreeTextSearch&action=search [L,QSA]


#BSRD-272
RewriteRule ^agentdemo/?$ http://agent.trulia.com/acton/fs/blocks/showLandingPage/a/2844/p/p-00ad/t/page/fm/0 [L,QSA]

# BSAE-2309
RewriteRule ^remaxagents/?$ http://agent.trulia.com/acton/fs/blocks/showLandingPage/a/2844/p/p-00a2/t/page/fm/0 [L,QSA]

#Altman intern campaign - JF 3/13/2013
RewriteRule ^altmanintern$ altmanintern/ [L,R=301,NC]
RewriteRule ^altmanintern/$ mvc_handler.php?dir=Promo&controller=AltmanIntern [L,QSA]
RewriteRule ^altmanintern/$ altmanintern/ [L,R=301,NC]

# spotlight pseudo-javascript
RewriteRule ^spotlight\.js$ spotlight_server.php [L,QSA]
RewriteRule ^ad_click/?$ spotlight_click.php [L,QSA]

# lazy loaded html modules
RewriteRule ^modules/(.+)$ mvc_handler.php?dir=Async&controller=Modules&modules=$1 [QSA,L]

# house ads
RewriteRule ^houseads/(\w+)/(\d+x\w+)/(\w+)?/?$ mvc_handler.php?dir=HouseAds&controller=$1&size=$2&action=$3 [QSA,L]

# self service pseudo-javascript
RewriteRule ^self_service\.js$ self_service_server.php [L,QSA]
# self service ads
RewriteRule ^ssa_click/?$ self_service_ad_click.php [L,QSA]
#RewriteRule ^ad/?$ ads [L,R=301]
#RewriteRule ^ads/?$ self_service_ad_promo.php [L,QSA]
RewriteRule ^ad/?$ localads [L,R=301]
RewriteRule ^ads/?$ localads [L,R=301]
RewriteRule ^localad/?$ localads [L,R=301]
RewriteRule ^localads/?$ mvc_handler.php?dir=BusinessServices/TruliaLocalAds/Product&controller=TruliaLocalAdsProduct [L,QSA]
RewriteRule ^localads/qc_demo$ mvc_handler.php?dir=BusinessServices/TruliaLocalAds&controller=QuickConnectDemo [L,QSA]
RewriteRule ^remax/localads/?$ biz_solutions.php?page_name=partners_local_ad&src=300004 [L,QSA]
RewriteRule ^ad/step_one_broker/? self_service_step_one_broker.php [L,QSA]
RewriteRule ^ad/step_one/? self_service_step_one.php [L,QSA]
RewriteRule ^ad/step_two/login/? self_service_step_two_login.php [L,QSA]
RewriteRule ^ad/step_two/password/? self_service_step_two_password.php [L,QSA]
RewriteRule ^ad/step_two/([0-9]+)/([0-9]+)/? self_service_step_two.php?order_id=$1&order_change_id=$2 [L,QSA,R]
RewriteRule ^ad/step_two/([0-9]+)/? self_service_step_two.php?order_id=$1 [L,QSA,R]
RewriteRule ^ad/step_two/? self_service_step_two.php [L,QSA]
RewriteRule ^ad/step_three/? self_service_step_three.php [L,QSA]
RewriteRule ^ad/step_three_upgrade/? self_service_step_three.php?upgrade=1 [L,QSA]
RewriteRule ^ad/edit/? self_service_edit_order.php [L,QSA]
RewriteRule ^ad/manage/tsa/? mvc_handler.php?dir=AdPlatform&controller=TSAReporting [L,QSA]
RewriteRule ^ad/manage/tma/? mvc_handler.php?dir=AdPlatform&controller=TMAReporting [L,QSA]
RewriteRule ^ad/manage/ssa/? mytrulia_self_service_ad.php?ad_type=ssa [L,QSA]
RewriteRule ^ad/manage/? mytrulia_self_service_ad.php [L,QSA]
RewriteRule ^ad/graph/graph.png?(.*)$ get_chart.php [L,QSA]
RewriteRule ^ad/reactivate/?$ self_service_ad_reactivate.php
RewriteRule ^ad/cancel/?$ self_service_ad_cancel.php
RewriteRule ^ad/preview/?$ self_service_ad_preview.php [L,QSA]
RewriteRule ^ad/upgrade/?$ self_service_upgrade.php [L,QSA]
RewriteRule ^ad/renew/?$ self_service_renew.php [L,QSA]
RewriteRule ^ad/renew/([0-9]+)/?$ /ad/renew/?order_id=$1 [L,QSA,R]
RewriteRule ^ad/report/download/([0-9]+)/([0-9]{4})/([0-9]{2})/([0-9a-f]{32})/ self_service_broker_report_download.php?order_id=$1&year=$2&month=$3&check_hash=$4 [L,QSA]
RewriteRule ^local_market/? biz_solutions.php?page_name=rivals_landing [L,QSA]
RewriteRule ^local_ad_market/? biz_solutions.php?page_name=partners_local_ad_min [L,QSA]
RewriteRule ^ad/terms\/?$ biz_solutions.php?page_name=local_ads_terms

# fix bad TLA ajax URLs
RewriteRule ^www/q_self_service_broker_carousel.php q_self_service_broker_carousel.php
RewriteRule ^www/q_self_service_single_listing.php q_self_service_single_listing.php
RewriteRule ^www/q_self_service_lead_form.php q_self_service_lead_form.php

RewriteRule ^ad/demo/(.*)/$ ad_demo.php?encdt=$1

#facebook incomeing traffic tracking and redirect
RewriteRule ^facebook/redirect/(.*)/(.*)/?$ facebook_redirect.php?encdt=$1&section=$2

# Ajax controller requests
# Example:
# _ajax/folder/MyController/myaction/?param1=foo&param2=bar
# transforms to
# mvc_handler.php?dir=folder&controller=MyController&action=myaction&param1=foo&param2=bar
# The first '?' will be converted into a '&' by php, e.g. ?param1=foo -> &param1=foo
#            _ajax dir              controller        optional-action     params
# RewriteRule ^_ajax/([a-zA-Z0-9_-]+)/([a-zA-Z0-9_-]+)/(([a-zA-Z0-9_-]+)/)?(.*)$ mvc_handler.php?dir=$1&controller=$2&action=$4 [L,QSA]
RewriteRule ^_ajax/([a-zA-Z0-9_-]+)/([a-zA-Z0-9_-]+)/(?:([a-zA-Z0-9_-]+)/)? mvc_handler.php?dir=$1&controller=$2&action=$3 [L,QSA]

# Service Client proxy
# Example:
# _service/TruliaCoreg/lead
# transforms to
# mvc_handler.php?dir=ServiceClient&controller=ServiceClient&action=proxy_request&service_name=TruliaCoreg&path=/lead
# This will execute the service located in Common at Service/Client/Trulia/Coreg/ServiceClientTruliaCoreg.php
RewriteRule ^_service/([A-Za-z_]+)(/.*)$ mvc_handler.php?dir=ServiceClient&controller=ServiceClient&action=proxy_request&service_name=$1&path=$2 [L,QSA]

#url shortener redirect
RewriteRule ^x([a-z0-9]{6,10})$ q_short_url.php?short_url=$1 [L]

# trulia seller ads consumer pages (required is here only for reporting purposes, not for users to actually visit)
RewriteRule ^sell/?$ mvc_handler.php?dir=SellerLeads&controller=ConsumerTSA&action=index [L,QSA]
RewriteRule ^sell/demo/([0-9]+)/?$ mvc_handler.php?dir=SellerLeads&controller=ConsumerTSA&action=index&demo_user_id=$1 [L,QSA]
RewriteRule ^sell/required/?$ mvc_handler.php?dir=SellerLeads&controller=ConsumerTSA&action=required [L,QSA]
RewriteRule ^sell/required/demo/([0-9]+)/?$ mvc_handler.php?dir=SellerLeads&controller=ConsumerTSA&action=required&demo_user_id=$1 [L,QSA]

# trulia seller ads product pages
RewriteRule ^sellerads/?$ mvc_handler.php?dir=BusinessServices/TruliaSellerAds&controller=TruliaSellerAdsLanding [L,QSA]
RewriteRule ^sellerads/inquire/?$ mvc_handler.php?dir=AdPlatform&controller=TSAAjax&action=inquire [L,QSA]

#lead inbox
RewriteRule ^inbox/download/?$ lead_inbox_download.php [L,QSA]
RewriteRule ^inbox$ inbox/ [L,R=301,QSA]
RewriteRule ^inbox/ lead_inbox.php [L,QSA]
RewriteRule ^inbox/gg(.*)$ inbox/#$1 [L,R=301,QSA]

RewriteRule ^lead_inbox/?$ mvc_handler.php?dir=LeadInbox&controller=LeadInbox&action=inbox [L,QSA]
RewriteRule ^lead_inbox/messages/(\d+)/?$ mvc_handler.php?dir=LeadInbox&controller=LeadInboxAjax&action=messages&messageId=$1 [L,QSA]

# lead routing
RewriteRule ^twilio/phone_lead_completion/([0-9]+)/? mvc_handler.php?dir=LeadInbox&controller=Dispatch&action=phone_lead_completion&phone_call_id=$1 [L,QSA]
RewriteRule ^twilio/phone_lead_completion/? mvc_handler.php?dir=LeadInbox&controller=Dispatch&action=phone_lead_completion [L,QSA]
RewriteRule ^twilio/phone_lead_whisper/? mvc_handler.php?dir=LeadInbox&controller=Dispatch&action=phone_lead_whisper [L,QSA]
RewriteRule ^twilio/phone_lead/? mvc_handler.php?dir=LeadInbox&controller=Dispatch&action=phone_lead [L,QSA]
RewriteRule ^twilio/ttv/?$ mvc_handler.php?dir=LeadInbox&controller=Dispatch&action=ttv [L,QSA]
RewriteRule ^twilio/ttv_connect/?$ mvc_handler.php?dir=LeadInbox&controller=Dispatch&action=ttv_connect [L,QSA]
RewriteRule ^twilio/ttv_completion/?$ mvc_handler.php?dir=LeadInbox&controller=Dispatch&action=ttv_completion [L,QSA]
RewriteRule ^twilio/my_leads_notification/?$ mvc_handler.php?dir=LeadInbox&controller=Dispatch&action=my_leads_notification [L,QSA]
RewriteRule ^twilio/billing_failure/([a-z_]+)/(\d+)/?$ mvc_handler.php?dir=LeadInbox&controller=Dispatch&action=billing_failure&reminder_type=$1&reminder_id=$2 [L,QSA]
RewriteRule ^twilio/sls_verify(.*)$ mvc_handler.php?dir=SLS&controller=SlsDispatch&action=provide_pin [L,QSA]
RewriteRule ^twilio/sms_completion/?$ mvc_handler.php?dir=LeadInbox&controller=Dispatch&action=sms_completion [L,QSA]

RewriteRule ^instant/activate/?$ mvc_handler.php?dir=LeadInbox&controller=DispatchManagement&action=activate_instant_leads [L,QSA]

#phone call tracking
RewriteRule ^twilio/phone_track_completion/([0-9]+)/? mvc_handler.php?dir=PhoneCall&controller=CallTracking&action=phone_call_tracking_completion&phone_call_id=$1 [L,QSA]
RewriteRule ^twilio/phone_track/? mvc_handler.php?dir=PhoneCall&controller=CallTracking&action=phone_call_tracking [L,QSA]

RewriteRule ^geocode(.*)$ mvc_handler.php?dir=Location&controller=Geocoder&action=geocode [L,QSA]

#Report Fraud from email proxy
RewriteRule ^report-fraud/(.*)$ mvc_handler.php?dir=Rentals&controller=ReportFraud&propertyId=$1&userEmail=$2 [QSA,L]

# Rentals Post-Lead email images
RewriteRule ^rental/post-lead/([0-9]*)/(.*)/(.*)/(.*)$ mvc_handler.php?dir=LeadInbox&controller=LeadAdditionalQuestion&action=show_post_lead_image&date=$1&type=$2&email=$3 [L]

RewriteRule ^rental-listings/failure/success(.*)$ mvc_handler.php?dir=SLS&controller=RentalsRepeal&action=success [L,QSA]
RewriteRule ^rental-listings/verification-failure/process(.*)$ mvc_handler.php?dir=SLS&controller=RentalsRepeal&action=form_process [L,QSA]
RewriteRule ^rental-listings/failure/process(.*)$ mvc_handler.php?dir=SLS&controller=RentalsRepeal&action=form_process [L,QSA]
RewriteRule ^rental-listings/verification-failure(.*)$ mvc_handler.php?dir=SLS&controller=RentalsRepeal&action=verify_fail [L,QSA]
RewriteRule ^rental-listings/failure(.*)$ mvc_handler.php?dir=SLS&controller=RentalsRepeal&action=listing_fail [L,QSA]

# Lead Shopping Cart Router
RewriteRule ^saved-homes(/)?$ mvc_handler.php?dir=LeadShoppingCart&controller=LeadShoppingCart&action=index [QSA,L]

# New SLS rentals path
RewriteRule ^post-rental(/)?$ mvc_handler.php?dir=Rentals&controller=SlsLandingPage&action=landing_page [L,QSA]
RewriteRule ^post-listing(.*)$ mvc_handler.php?dir=SLS&controller=SlsStep [QSA,L]

# Rentals Walkscore Feed
RewriteRule ^walkscore_feed.xml$ SLSRentalDBToXML.php?walkscore=true [QSA,L]

# Renter newsletter link - RENT-2906
RewriteRule ^local-rentals/?$ mvc_handler.php?dir=Rentals&controller=LocalRentals&action=local_srp_redirect [L,QSA]

# Error page
RewriteRule ^error/?$ mvc_handler.php?dir=Error&controller=ErrorPage&action=index [L,QSA]

# Redirect to the new error page if it contains error code.
RewriteCond %{QUERY_STRING} (.*)error_code=(.*)
RewriteRule ^homepage.php$ mvc_handler.php?dir=Error&controller=ErrorPage&action=index [L,QSA]

# backward compat for old homepage.php links
RewriteRule ^homepage.php$ mvc_handler.php?dir=Home&controller=Homepage [QSA,L]

# TPP iframe plugs
RewriteRule ^external/header/?$ mvc_handler.php?dir=Helpers&controller=Branded&action=header [L]
RewriteRule ^external/footer/?$ mvc_handler.php?dir=Helpers&controller=Branded&action=footer [L]

#redirect obsolete mylist urls
RewriteRule ^mylist(.*)$ account/ [L,R=301]

# Redirect to error page if it contains an error code.
RewriteCond %{QUERY_STRING} (.*)error_code=(.*)
RewriteRule ^$ mvc_handler.php?dir=Error&controller=ErrorPage&action=index [QSA,L]

# Home page
RewriteRule ^$ mvc_handler.php?dir=Home&controller=Homepage [QSA,L]

RewriteRule ^austin/?$ / [L,NC,R=301]
RewriteRule ^rent/?$ mvc_handler.php?dir=Home&controller=Homepage&ptype=for_rent [QSA,L]
RewriteRule ^searchbox/(.*)$ validate.php$1
# E.g., /advanced_results/?nhct=43&state=NY&city=New+York&a_county=New+York&a_school=&min_price=&max_price=&min_num_beds=&max_num_beds=&min_num_baths=&max_num_baths=&min_size=&max_size=&toggle_type_checkbox=on&pt%5B0%5D=apartment&pt%5B1%5D=apartment%2Ccondo%2Ctownhouse&pt%5B2%5D=condo&pt%5B3%5D=coop&pt%5B4%5D=farm&pt%5B5%5D=houseboat&pt%5B6%5D=investment&pt%5B7%5D=loft&pt%5B8%5D=lot&pt%5B9%5D=mobile&pt%5B10%5D=multifamily&pt%5B11%5D=single-family&pt%5B12%5D=tic&pt%5B13%5D=townhouse&pt%5B14%5D=unspecified&toggle_neighborhoods=on&nh%5B0%5D=5028&nh%5B1%5D=5059&nh%5B2%5D=5061&nh%5B3%5D=5062&nh%5B4%5D=5064&nh%5B5%5D=5069&nh%5B6%5D=5089&nh%5B7%5D=5091&nh%5B8%5D=5101&nh%5B9%5D=5103&nh%5B10%5D=5112&nh%5B11%5D=5117&nh%5B12%5D=5121&nh%5B13%5D=5126&nh%5B14%5D=5129&nh%5B15%5D=5131&nh%5B16%5D=5133&nh%5B17%5D=5140&nh%5B18%5D=5150&nh%5B19%5D=5151&nh%5B20%5D=5154&nh%5B21%5D=5156&nh%5B22%5D=5158&nh%5B23%5D=5159&nh%5B24%5D=5171&nh%5B25%5D=5172&nh%5B26%5D=5173&nh%5B27%5D=5176&nh%5B28%5D=5184&nh%5B29%5D=5190&nh%5B30%5D=5191&nh%5B31%5D=5224&nh%5B32%5D=5233&nh%5B33%5D=5243&nh%5B34%5D=5248&nh%5B35%5D=5255&nh%5B36%5D=5256&nh%5B37%5D=5257&nh%5B38%5D=5260&nh%5B39%5D=5261&nh%5B40%5D=5266&nh%5B41%5D=5269&nh%5B42%5D=5281&a_street_number=&a_street=5th+avenue&a_apartment_number=&advanced=1&searchButton.x=42&searchButton.y=11
RewriteRule ^advanced_results(.*)$ mvc_handler.php?dir=SRP&controller=SRP&action=list&url=$1 [L]
RewriteRule ^advanced[^/]*$ advanced/
RewriteRule ^advanced/error/(.*)$ search_advanced_search.php$1
RewriteRule ^advanced/(.*)$ search_advanced_search.php?tab=$1
RewriteRule ^login[^\?/]*$ login/
RewriteRule ^login/e/([^/]*)/*$ registration.php?type=login&email=$1 [QSA]
RewriteRule ^login/r/(.*)$ registration.php?type=login&return_url=$1 [QSA]
RewriteRule ^login/e_([^/]+)/r_(.+)$ registration.php?type=login&email=$1&return_url=$2 [QSA]
RewriteRule ^login/([^/]+)/*$ registration.php?type=login&param=$1
RewriteRule ^login/$ registration.php?type=login

RewriteRule ^pwd_login[^\?/]*$ pwd_login/
RewriteRule ^pwd_login/e/([^/]*)/*$ registration.php?type=pwd_login&email=$1
RewriteRule ^pwd_login/r/(.*)$ registration.php?type=pwd_login&return_url=$1
RewriteRule ^pwd_login/e_([^/]+)/r_(.+)$ registration.php?type=pwd_login&email=$1&return_url=$2
RewriteRule ^pwd_login/$ registration.php?type=pwd_login

# criteo retargeting page
RewriteRule ^getupdates(/|/(\d+)/?)?$ mvc_handler.php?dir=Registration&controller=SearchRetargeting&pid=$2 [QSA]

RewriteRule ^agent_login/?$ submit_listings/
# auto login handshake
RewriteRule ^handshake/?$ auto_login.php [L,QSA]

RewriteRule ^logout[^/]*$ logout/
RewriteRule ^logout/$ log_out.php
# track paid search engine clicks
RewriteRule ^email/([^/]+)/(.+) landing.php?ecampaign=$1&eurl=$2 [L,QSA]
# URL to force TPP
RewriteRule ^settpp/([^/]+)/(.+) landing.php?tpp=$1&url=$2 [L,QSA]
# track widget traffic
RewriteRule ^syndication\/? landing.php
RewriteRule ^synd\/? landing.php

# Redirect Marketing Media Kit
RewriteRule ^mediakit\/?$ http://static.trulia-cdn.com/images/business_center/pdf/Trulia_Media_Kit_120306.pdf [L,R=301]
RewriteRule ^prudential/?$ http://info.trulia.com/index.php?s=68&item=86 [L,R=301]
RewriteRule ^MLSsyndication/?$ http://filecache.drivetheweb.com/mr4enh_trulia/616/download/MLS-Advisory-Board-Syndication-Guide.pdf [L,R=301]
RewriteRule ^info/(.+) press_redirects.php?url=$1 [L,QSA]

# interstitial page for featured listings
# tfl/p=1234&u=http://www.trulia.com/property/1234-blahblah
RewriteRule ^tfl/p=([0-9]+)&u=(.*)$ track_featured.php?pid=$1&url=$2
RewriteRule ^signup/r/(.*)/*$ registration.php?type=signup&return_url=$1 [QSA]
RewriteRule ^signup/e/([^/]*)/*$ registration.php?type=signup&email=$1
RewriteRule ^signup/e_([^/]+)/r_(.+)$ registration.php?type=signup&email=$1&return_url=$2
RewriteRule ^fbsignup/r/(.*)/*$ registration.php?type=facebook_followup&return_url=$1
RewriteRule ^fbsignup[^/]*$ fbsignup/
RewriteRule ^fbsignup/$ registration.php?type=facebook_followup
RewriteRule ^signup[^/]*$ signup/
RewriteRule ^signup/$ registration.php?type=signup
RewriteRule ^mytrulia/?$ registration.php?type=login
RewriteRule ^process_signup[^/]*$ process_signup/
RewriteRule ^process_signup/$ new_account_process.php
RewriteRule ^school_study/?$ school_study_mar08.php

# redirect from /account/ to /account/properties/ in the code
RewriteRule ^account/?$ my_account.php
RewriteRule ^account/overview/?$ mytrulia_overview.php
RewriteRule ^account/properties/?(.*)/?$ mytrulia_favorites.php?url=$1
RewriteRule ^account/follow_areas/?(.*)/?$ mytrulia_follow_areas.php?url=$1
RewriteRule ^account/settings\/?$ user_profile_edit.php
RewriteRule ^account/settings/([A-Za-z_]+)/?$ user_profile_edit.php?section=$1
RewriteRule ^account/qanda\/?$ myprofile/qanda/ [R=301,L]
RewriteRule ^account/qanda\/(.*)\/?$ myprofile/qanda/$1/ [R=301,L]
RewriteRule ^account/details/?$ account_settings.php
RewriteRule ^account/email/confirm/?$ profile_multi_email_confirm.php [L,QSA]
# some old emails still use this old link
RewriteRule ^account/billing/review/?$ account_settings.php

RewriteRule ^account/checklist/?(.*)/?$ mytrulia_checklist.php?list=$1

RewriteRule ^account/searches/?$ mytrulia_searches.php
RewriteRule ^account/alerts/?$ mytrulia_email_alerts.php
RewriteRule ^account/email_preferences/?$ mytrulia_email_preferences.php
RewriteRule ^account/lead_preferences/?$ mvc_handler.php?dir=Account&controller=LeadPreferences&action=lead_preferences [L,QSA]
RewriteRule ^account/lead_preferences/locations/$ mvc_handler.php?dir=Account&controller=LeadPreferencesAjax&action=locations [L,QSA]
RewriteRule ^account/lead_preferences/locations/(\d+)/?$ mvc_handler.php?dir=Account&controller=LeadPreferencesAjax&action=locations&locationId=$1 [L,QSA]
RewriteRule ^account/reporting/? mvc_handler.php?dir=Reporting&controller=Reporting [L,QSA]

#Wake the Dead Campaign
RewriteRule ^myprofile/confirmemail/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&profile_type=private&wake=true [L,QSA]

#My Recommendations
RewriteRule ^recommendation/request/([A-Za-z_]+)/?$ recommendation_request.php?section=$1 [L,QSA]
RewriteRule ^myprofile/recommendation/?$ recommendation_request.php [L,QSA]
#RewriteRule ^myprofile/recommendation/?$ my_recommendation.php [L,QSA]
RewriteRule ^recommendation/verification/([A-Za-z_]+)/(.*)/?$ recommendation_verificaton_action.php?action=$1&code=$2 [L,QSA]

RewriteRule ^account/searches/saved/?$ mytrulia_searches.php?tab_name=saved_searches_tab
RewriteRule ^account/searches/recent/?$ mytrulia_searches.php?tab_name=recent_searches_tab
RewriteRule ^account/searches/shared/?$ mytrulia_searches.php?tab_name=shared_searches_tab

RewriteRule ^account/alerts/search/?$ mytrulia_email_alerts.php?tab_name=search_alerts_tab
RewriteRule ^account/alerts/property/?$ mytrulia_email_alerts.php?tab_name=property_alerts_tab
RewriteRule ^account/alerts/voices/?$ mytrulia_email_alerts.php?tab_name=voices_alerts_tab

#MORE RENTAL GOODNESS
RewriteRule ^account/listings/rental/edit/([0-9]+)?$ listings_management.php?property_id=$1&prop_type=rental
RewriteRule ^account/listings/rental/open_homes/([0-9]+)?$ listings_management.php?expand=open_homes&property_id=$1&prop_type=rental
RewriteRule ^account/listings/rental/photos/([0-9]+)?$ listings_management.php?expand=photos&property_id=$1&prop_type=rental
RewriteRule ^account/listings/rental/sls/edit/([0-9]+)?$ sls_listings_management.php?submit_id=$1&prop_type=rental
RewriteRule ^account/listings/rental/sls/open_homes/([0-9]+)?$ sls_listings_management.php?expand=open_homes&submit_id=$1&prop_type=rental
RewriteRule ^account/listings/rental/sls/detail/([0-9]+)?$ sls_listings_management.php?expand=property_info&submit_id=$1&prop_type=rental
RewriteRule ^account/listings/rental/sls/photos/([0-9]+)?$ sls_listings_management.php?expand=photos&submit_id=$1&prop_type=rental
RewriteRule ^account/listings/rental/resubmit/([0-9]+)$ listings_management.php?property_id=$1&resubmit=1&prop_type=rental
#RewriteRule ^account/listings/rental/add/([0-9]+)?$ my_listings_new.php?add_pid=$1&prop_type=rental claimed featured not supported yet
RewriteRule ^account/listings/rental/?$ my_listings_new.php?prop_type=rental [QSA]

RewriteRule ^account/listings/add/([0-9]+)?$ my_listings_new.php?add_pid=$1

RewriteRule ^account/listings/autoclr/?$ my_listings_autoclr.php [L,QSA]
RewriteRule ^account/listings/?$ my_listings_new.php
RewriteRule ^account/featured/?$ account/listings/ [L,R=301]
RewriteRule ^account/listings/edit/([0-9]+)?$ listings_management.php?property_id=$1
RewriteRule ^account/listings/open_homes/([0-9]+)?$ listings_management.php?expand=open_homes&property_id=$1
RewriteRule ^account/listings/detail/([0-9]+)?$ listings_management.php?expand=property_info&property_id=$1
RewriteRule ^account/listings/photos/([0-9]+)?$ listings_management.php?expand=photos&property_id=$1
RewriteRule ^account/listings/status_change/([0-9]+)?$ listings_management.php?expand=status_change&property_id=$1

RewriteRule ^account/listings/sls/edit/([0-9]+)?$ sls_listings_management.php?submit_id=$1
RewriteRule ^account/listings/sls/open_homes/([0-9]+)?$ sls_listings_management.php?expand=open_homes&submit_id=$1
RewriteRule ^account/listings/sls/detail/([0-9]+)?$ sls_listings_management.php?expand=property_info&submit_id=$1
RewriteRule ^account/listings/sls/photos/([0-9]+)?$ sls_listings_management.php?expand=photos&submit_id=$1
RewriteRule ^account/listings/sls/status_change/([0-9]+)?$ sls_listings_management.php?expand=status_change&submit_id=$1
RewriteRule ^account/listings/resubmit/([0-9]+)$ listings_management.php?property_id=$1&resubmit=1
RewriteRule ^account/voices_activity/?$ mytrulia_vip_stats.php
RewriteRule ^account/listings/stats/([0-9]+)/for_rent/?$ my_listings_stats.php?property_id=$1&status=for_rent [L,QSA]
RewriteRule ^account/listings/stats/([0-9]+)/?$ my_listings_stats.php?property_id=$1 [L,QSA]
RewriteRule ^account/listings/stats/([0-9]+)/([0-9,]+)/(pdp|srp)/(for_sale|for_rent)/30_day/graph.png$ get_chart.php?type=my_listings_$3_impressions&property_id=$1&listing_ids=$2&property_type=$4&width=715&height=300 [L]
RewriteRule ^account/listings/stats/? my_listings_stats_index.php [L,QSA]
RewriteRule ^account/listings/open_home_list/?$ my_listings_open_homes.php [L,QSA]

RewriteRule ^account/listings/sold/?$ mvc_handler.php?controller=MyListingsPageSoldClaims&action=index&dir=ListingManagement [L,QSA]
RewriteRule ^account/listings/sold/page/?$ mvc_handler.php?controller=MyListingsPageSoldClaims&action=page&dir=ListingManagement [L,QSA]

# Short URL for adding sold listings
RewriteRule ^pastsales/?$ account/listings/search/?type=sold [L,R=301,QSA]

RewriteRule ^account/listings/search/?$ mvc_handler.php?controller=ClaimListingSearch&action=index&dir=ListingManagement [L,QSA]
RewriteRule ^account/listings/search/sold/details/?$ mvc_handler.php?controller=ClaimSoldDetailForm&action=details&dir=ListingManagement [L,QSA]
RewriteRule ^account/listings/search/sold/upload/(.+)/?$ mvc_handler.php?controller=ClaimSoldDetailForm&action=upload&dir=ListingManagement&detail_id=$1 [L,QSA]
RewriteRule ^account/listings/search/sold/verify/?$ mvc_handler.php?controller=ClaimSoldDetailForm&action=verify&dir=ListingManagement [L,QSA]
RewriteRule ^account/listings/search/sold/verify/pk/(.+)/?$ mvc_handler.php?controller=ClaimSoldDetailForm&action=verify&dir=ListingManagement&property_key=$1 [L,QSA]
RewriteRule ^account/listings/search/sold/edit/?$ mvc_handler.php?controller=ClaimSoldDetailForm&action=edit&dir=ListingManagement [L,QSA]
RewriteRule ^account/listings/search/sold/edit/pk/([^/]+)/?$ mvc_handler.php?controller=ClaimSoldDetailForm&action=edit&dir=ListingManagement&detail_id=$1 [L,QSA]
RewriteRule ^account/listings/search/sold/update/pk/([^/]+)/?$ mvc_handler.php?controller=ClaimSoldDetailForm&action=update&dir=ListingManagement&detail_id=$1 [L,QSA]
RewriteRule ^account/listings/search/sold/edit/pk/([^/]+)/photos/?$ mvc_handler.php?controller=ClaimSoldDetailForm&action=photos&dir=ListingManagement&detail_id=$1 [L,QSA]

RewriteRule ^approveclaim/(.*)/$ mvc_handler.php?dir=ListingManagement&controller=ManualClaim&action=index&claimcode=$1 [L,QSA]

RewriteRule ^update/propertydetail/(.*)/$ update_property_detail_redirect.php?encdata=$1

# cancel or reactivate your truli pro account
RewriteRule ^account/billing/cancel/?$ trulia_pro_cancel.php [L,QSA]
RewriteRule ^account/billing/reactivate/?$ user_reactivate_truliapro_subscription.php [L,QSA]

# email unsub choices page for non-logged-in users
RewriteRule ^account/email/?$ my_account_unsub.php
RewriteRule ^account/email/process/?$ my_account_unsub_process.php

#email unsub from footer
RewriteRule ^unsub$ mvc_handler.php?dir=Email&controller=Unsub&action=index [L,QSA]

# on demand client listing report
#RewriteRule ^clr/([0-9]+)/?$ email_property_stats.php?property_id=$1 [L,QSA]
#RewriteRule ^clr/?$ email_property_stats.php [L,QSA]
#RewriteRule ^clr/schedule/?$ clr_scheduler.php [L,QSA]
#RewriteRule ^clr/schedule/([0-9]+)/?$ clr_scheduler.php?property_id=$1 [L,QSA]

# redirect anything which starts with /clr/ to new /contacts/ page
RewriteRule ^clr/ contacts/ [R=301,QSA,L]

# new contact page
RewriteRule ^contacts$ contacts/ [R=301,QSA,L]
RewriteRule ^contacts$ mvc_handler.php?controller=AllContacts&dir=Contacts&action=index
RewriteRule ^contacts/?$ mvc_handler.php?controller=AllContacts&dir=Contacts&action=index [L,QSA]
RewriteRule ^contacts/import/([^\/]+)$ contacts/import/$1/
RewriteRule ^contacts/import/([^\/]+)/$ mvc_handler.php?controller=ContactEdit&action=page&dir=Contacts&page=import_list&source=$1 [L,QSA]
RewriteRule ^contacts/edit/([0-9]+)/?$ mvc_handler.php?controller=ContactEdit&action=page&dir=Contacts&page=add&contact_id=$1 [L,QSA]
RewriteRule ^contacts/search_alerts/([0-9]+)/edit/([0-9]+)/?$ mvc_handler.php?controller=ContactSearchAlert&dir=Contacts&action=index&contact_id=$1&contact_user_query_id=$2 [L,QSA]
RewriteRule ^contacts/search_alerts/([0-9]+)/?$ mvc_handler.php?controller=ContactSearchAlert&dir=Contacts&action=index&contact_id=$1 [L,QSA]
RewriteRule ^contacts/([^\/]+)$ contacts/$1/ [R=301,QSA,L]
RewriteRule ^contacts/([^\/]+)/$ mvc_handler.php?controller=ContactEdit&action=page&dir=Contacts&page=$1 [L,QSA]

#RewriteRule ^account/([^/]+)/*$ my_account.php?param=$1
# error param
RewriteRule ^optin/r/([^/]+)/* opt_in.php?param=$1
RewriteRule ^optin$ optin/
RewriteRule ^optin/$ opt_in.php
RewriteRule ^optin/cml/([^/]+)/*$ opt_in.php?custom_content=cml&key=$1
RewriteRule ^optin/([^/]+)/*$ opt_in.php?key=$1
RewriteRule ^optin/([^/]+)/([^/]+)/*$ opt_in.php?key=$1&ct=$2
RewriteRule ^forgot_password/e/([^/]*)/*$ registration.php?type=pwd&email=$1
RewriteRule ^forgot_password/r/(.*)$ registration.php?type=pwd&return_url=$1
RewriteRule ^forgot_password/e_([^/]+)/r_(.+)$ registration.php?type=pwd&email=$1&return_url=$2
RewriteRule ^forgot_password$ forgot_password/
RewriteRule ^forgot_password/$ registration.php?type=pwd
RewriteRule ^forgot_password/([^/]+)/*$ registration.php?type=pwd&param=$1
RewriteRule ^change_account(.*) change_user_info.php

RewriteRule ^t_([a-z0-9]+)\/*$ / [L,R=301]

# SEO New Property
RewriteRule ^new-for-sale-properties/([A-Za-z]+)/p_([0-9]+)/?$ mvc_handler.php?dir=SeoTopic&controller=SeoNewProperty&action=index&state=$1&page=$2&type=forsale
RewriteRule ^new-for-sale-properties/([A-Za-z]+)?/?$ mvc_handler.php?dir=SeoTopic&controller=SeoNewProperty&action=index&state=$1&type=forsale [L,QSA]
RewriteRule ^new-for-sale-properties/p_([0-9]+)/?$ mvc_handler.php?dir=SeoTopic&controller=SeoNewProperty&action=index&page=$1&type=forsale [L,QSA]
RewriteRule ^new-for-sale-properties/?$ mvc_handler.php?dir=SeoTopic&controller=SeoNewProperty&action=index&type=forsale [L,QSA]
RewriteRule ^new-for-rent-properties/([A-Za-z]+)/p_([0-9]+)/?$ mvc_handler.php?dir=SeoTopic&controller=SeoNewProperty&action=index&state=$1&page=$2&type=forrent
RewriteRule ^new-for-rent-properties/([A-Za-z]+)?/?$ mvc_handler.php?dir=SeoTopic&controller=SeoNewProperty&action=index&state=$1&type=forrent [L,QSA]
RewriteRule ^new-for-rent-properties/p_([0-9]+)/?$ mvc_handler.php?dir=SeoTopic&controller=SeoNewProperty&action=index&page=$1&type=forrent [L,QSA]
RewriteRule ^new-for-rent-properties/?$ mvc_handler.php?dir=SeoTopic&controller=SeoNewProperty&action=index&type=forrent [L,QSA]

#Rental Communities Sitemap
RewriteRule ^community-rental-properties/?$ mvc_handler.php?dir=Rentals&controller=RentalCommunitySitemap&action=index
RewriteRule ^community-rental-properties/p_([0-9]+)/?$ mvc_handler.php?dir=Rentals&controller=RentalCommunitySitemap&action=index&page=$1

# agent site map
RewriteRule ^sitemap/agent/?$ mvc_handler.php?controller=AgentSiteMapAlphabet&dir=AgentProfile [L,QSA]
RewriteRule ^sitemap/agent/([a-z]\-[a-z])/?$ mvc_handler.php?controller=AgentSiteMapAlphabet&dir=AgentProfile&action=section_list&section=$1 [L,QSA]
RewriteRule ^sitemap/agent/([a-z]\-[a-z])/(\d+)/?$ mvc_handler.php?controller=AgentSiteMapAlphabet&dir=AgentProfile&action=agent_list&section=$1&bucket=$2 [L,QSA]
RewriteRule ^sitemap/agent/([a-z]+)/?$ mvc_handler.php?controller=AgentSiteMapAlphabet&dir=AgentProfile&action=section_list&section=$1 [L,QSA]
RewriteRule ^sitemap/agent/([a-z]+)/(\d+)/?$ mvc_handler.php?controller=AgentSiteMapAlphabet&dir=AgentProfile&action=agent_list&section=$1&bucket=$2 [L,QSA]

# directory site map
RewriteRule ^sitemap/directory/?$ mvc_handler.php?controller=DirectorySiteMap&dir=FindAnAgent [L,QSA]
RewriteRule ^sitemap/directory/(\w+)/([A-Z]+)/?$ mvc_handler.php?controller=DirectorySiteMap&dir=FindAnAgent&action=groups&pro_status=$1&state=$2 [L,QSA]
RewriteRule ^sitemap/directory/(\w+)/([A-Z]+)/(\d+)/?$ mvc_handler.php?controller=DirectorySiteMap&dir=FindAnAgent&action=group_list&pro_status=$1&state=$2&group_id=$3 [L,QSA]

# popular city site map
RewriteRule ^sitemap/(popular-cit.*)$ mvc_handler.php?controller=PopularCitySiteMap&dir=PopularCity&action=index [L,QSA]
RewriteRule ^sitemap/(popular-rental-cit.*)$ mvc_handler.php?controller=RentalsPopularCitySiteMap&dir=PopularCity&action=index [L,QSA]

# site map
RewriteRule ^sitemap/([^/]+)$ sitemap/$1/ [L,QSA]
RewriteRule ^sitemap/([^/]+)/([^/]+)$ sitemap/$1/$2/ [L,QSA]
RewriteRule ^sitemap/(.+)/(.+)/$ map.php?state=$1&city_first=$2 [L,QSA]
RewriteRule ^sitemap/(.+)/$ map.php?state=$1 [L,QSA]
RewriteRule ^sitemap$ sitemap/ [L,QSA]
RewriteRule ^sitemap/$ map.php [L,QSA]

#seo topic sitemap page
#add slashes
RewriteRule ^kwd-sitemap/([^/]+)$ kwd-sitemap/$1/ [L,R=301,QSA]
RewriteRule ^kwd-sitemap/([^/]+)/([^/]+)$ kwd-sitemap/$1/$2/ [L,R=301,QSA]
RewriteRule ^kwd-sitemap/([^/]+)/1/$ kwd-sitemap/$1/ [L,R=301,QSA]
RewriteRule ^kwd-sitemap$ kwd-sitemap/ [L,QSA]

#city, state, default pages
RewriteRule ^kwd-sitemap/([A-Za-z_\-\']+?)-([A-Za-z_]+)-homes/([0-9]+)/$ mvc_handler.php?controller=SeoTopicSitemap&dir=SeoTopic&action=city&city=$1&state=$2&page_number=$3 [L,QSA]
RewriteRule ^kwd-sitemap/([A-Za-z_\-\']+?)-([A-Za-z_]+)-homes/$ mvc_handler.php?controller=SeoTopicSitemap&dir=SeoTopic&action=city&city=$1&state=$2 [L,QSA]
RewriteRule ^kwd-sitemap/([A-Za-z_]+)-homes/$ mvc_handler.php?controller=SeoTopicSitemap&dir=SeoTopic&action=state&state=$1 [L,QSA]
RewriteRule ^kwd-sitemap/([A-Za-z_]+)-homes/([0-9]+)/$ mvc_handler.php?controller=SeoTopicSitemap&dir=SeoTopic&action=state&state=$1&page_number=$2 [L,QSA]
RewriteRule ^kwd-sitemap/$ mvc_handler.php?controller=SeoTopicSitemap&dir=SeoTopic&action=index [L,QSA]


#FE-4765
RewriteRule ^(.*-real-estate)/$ map.php?state=$1 [L,QSA]
RewriteRule ^(.*-real-estate)/(.)/$ map.php?state=$1&city_first=$2 [L,QSA]

#rentals sitemap, mongoose
RewriteRule ^rent-sitemap/([^/]+)$ rent-sitemap/$1/
RewriteRule ^rent-sitemap/([^/]+)/([^/]+)$ rent-sitemap/$1/$2/
RewriteRule ^rent-sitemap/(.+)/(.+)/$ map.php?state=$1&city_first=$2&type=rent
RewriteRule ^rent-sitemap/(.+)/$ map.php?state=$1&type=rent
RewriteRule ^rent-sitemap$ rent-sitemap/
RewriteRule ^rent-sitemap/$ map.php?type=rent

RewriteRule ^property-sitemap/([A-Za-z]{2})/([^/]+)/([0-9]{5})/([0-9]+)/?$ assessor_sitemap.php?state_code=$1&city=$2&zip=$3&page=$4
RewriteRule ^property-sitemap/([A-Za-z]{2})/([^/]+)/([0-9]{5})/([^/]+)/?$ assessor_sitemap.php?state_code=$1&city=$2&zip=$3&street=$4
RewriteRule ^property-sitemap/([A-Za-z]{2})/([^/]+)/([0-9]{5})/([^/]+)/([0-9]+)?/?$ assessor_sitemap.php?state_code=$1&city=$2&zip=$3&street=$4&page=$5
RewriteRule ^property-sitemap/([A-Za-z]{2})/([^/]+)/([0-9]{5})/?$ assessor_sitemap.php?state_code=$1&city=$2&zip=$3
RewriteRule ^property-sitemap/([A-Za-z]{2})/([0-9]+)/?$ assessor_sitemap.php?state_code=$1&page=$2
RewriteRule ^property-sitemap/([A-Za-z]{2})/([^/]+)/([0-9]+)/?$ assessor_sitemap.php?state_code=$1&city=$2&page=$3&verify_location=1
RewriteRule ^property-sitemap/([A-Za-z]{2})/([^/]+)/?$ assessor_sitemap.php?state_code=$1&city=$2&verify_location=1
RewriteRule ^property-sitemap/([A-Za-z]{2})/?$ assessor_sitemap.php?state_code=$1
RewriteRule ^property-sitemap/?$ assessor_sitemap.php

#We have a new landing page to support a new partnership with EXIT Realty
RewriteRule ^exit/?$  http://agent.trulia.com/acton/fs/blocks/showLandingPage/a/2844/p/p-0066/t/page/fm/0 [L,QSA]
RewriteRule ^C21/?$ http://agent.trulia.com/acton/fs/blocks/showLandingPage/a/2844/p/p-001c/t/page/fm/0 [L,QSA]

RewriteRule ^fun$ fun/
RewriteRule ^fun/([^/]+)$ fun/$1/
RewriteRule ^fun/([^/]+)/$ fun_lists.php?list_name=$1
RewriteRule ^fun/$ fun_lists.php
RewriteRule ^testimonials$ testimonials/
RewriteRule ^testimonials\/?$ http://info.trulia.com/index.php?s=67 [L,R=301]
RewriteRule ^promote$ promote/
RewriteRule ^promote/.*$ advertisers/brokers/ [L,R=301]

RewriteRule ^brokers/localads\/?$ biz_solutions.php?page_name=brokers_billboard [L,QSA]
RewriteRule ^brokers\/?$ advertisers/brokers/ [L,R=301]
RewriteRule ^brokers/.*$ advertisers/brokers/ [L,R=301]

RewriteRule ^mls$ mls/ [L,R=301]
RewriteRule ^mls/$ biz_solutions.php?page_name=mls [L,QSA]

RewriteRule ^submit_listings/signup$ submit_listings/signup/
RewriteRule ^submit_listings/signup/$ sls_signup.php
RewriteRule ^submit_listings/enter_details/([0-9]+)?$ sls_step_one.php?sls_id=$1
RewriteRule ^submit_listings/enter_details/([0-9]+)/remove/?$ sls_step_one.php?sls_id=$1&delete=1
RewriteRule ^submit_listings/upload_photos/([0-9]+)?$ sls_step_two.php?sls_id=$1&prop_type=
RewriteRule ^submit_listings/preview/([0-9]+)?$ sls_step_three.php?sls_id=$1
RewriteRule ^submit_listings/success/([0-9]+)?$ sls_confirmation.php?sls_id=$1
RewriteRule ^submit_listings$ submit_listings/
RewriteRule ^submit_listings/feed/$ submit_site.php?feed
RewriteRule ^submit_listings/site/$ submit_site.php?site
RewriteRule ^submit_listings/.*$ biz_solutions.php?page_name=submit

# BSAE-2920: redirect old voices/profile links to profile
RewriteRule ^voices/profile/?$ profile/ [R=301,L]
RewriteRule ^voices/profile/(.*)$ profile/$1 [R=301,L]

# Profile Rewrites
RewriteRule ^myprofile/qanda/(a|q)\/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&profile_type=private&voices_type=$1 [L,QSA]
RewriteRule ^myprofile/qanda/(a|q)/p_([0-9]+)\/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&profile_type=private&page=$2&voices_type=$1 [L,QSA]
RewriteRule ^myprofile/blog\/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&profile_type=private&voices_type=blogs [L,QSA]
RewriteRule ^myprofile/blog/p_([0-9]+)\/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&profile_type=private&page=$1&voices_type=blogs [L,QSA]
RewriteRule ^profile/([0-9]+)\/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&user_id=$1 [L,QSA]
RewriteRule ^profile/([A-Za-z0-9_]+)\/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&vanity_url=$1 [L,QSA]
RewriteRule ^myprofile/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&profile_type=private [L,QSA]
RewriteRule ^profile/([0-9]+)/qanda/(a|q)\/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&user_id=$1&voices_type=$2 [L,QSA]
RewriteRule ^profile/([A-Za-z0-9_]+)/qanda/(a|q)\/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&vanity_url=$1&voices_type=$2 [L,QSA]
RewriteRule ^profile/([0-9]+)/qanda/(a|q)/p_([0-9]+)\/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&user_id=$1&page=$3&voices_type=$2 [L,QSA]
RewriteRule ^profile/([A-Za-z0-9_]+)/qanda/(a|q)/p_([0-9]+)\/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&vanity_url=$1&page=$3&voices_type=$2 [L,QSA]
RewriteRule ^profile/([0-9]+)/blog\/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&user_id=$1&voices_type=blogs [L,QSA]
RewriteRule ^profile/([A-Za-z0-9_]+)/blog\/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&vanity_url=$1&voices_type=blogs [L,QSA]
RewriteRule ^profile/([0-9]+)/blog/p_([0-9]+)\/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&user_id=$1&page=$2&voices_type=blogs [L,QSA]
RewriteRule ^profile/([A-Za-z0-9_]+)/blog/p_([0-9]+)\/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&vanity_url=$1&page=$2&voices_type=blogs [L,QSA]
RewriteRule ^profile/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile [QSA]
RewriteRule ^profile/(.*)-(.*)-([0-9]+)\/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&user_id=$3&profile_type=$1&profile_location=$2 [L,QSA]
RewriteRule ^profile/(.*)-(.*)-([0-9]+)/([A-Za-z]+)\/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&user_id=$3&voices_type=$4&profile_type=$1&profile_location=$2 [L,QSA]
RewriteRule ^profile/(.*)-(.*)-([0-9]+)/([A-Za-z]+)/p_([0-9]+)\/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&user_id=$3&voices_type=$4&page=$5&profile_type=$1&profile_location=$2 [L,QSA]
RewriteRule ^profile/(.*)-(.*)-([0-9]+)/qanda/([A-Za-z]+)\/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&user_id=$3&voices_type=$4&profile_type=$1&profile_location=$2 [L,QSA]
RewriteRule ^profile/(.*)-(.*)-([0-9]+)/qanda/([A-Za-z]+)/p_([0-9]+)\/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&user_id=$3&voices_type=$4&page=$5&profile_type=$1&profile_location=$2 [L,QSA]
RewriteRule ^profile/questions/(.*)-(.*)-([0-9]+)\/? mvc_handler.php?dir=User&controller=UserProfile&action=profile&user_id=$3&voices_type=questions&profile_type=$1&profile_location=$2 [L,QSA]
RewriteRule ^profile/id/([0-9]+)\/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&user_id=$1&redirect=1 [L,QSA]
RewriteRule ^profile/id/([0-9]+)/([A-Za-z]+)\/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&user_id=$1&voices_type=$2&redirect=1 [QSA,L]
RewriteRule ^profile/([A-Za-z0-9_]+)/questions\/? profile/$1/qanda/ [R=301,L]
RewriteRule ^profile/([A-Za-z0-9_]+)/([A-Za-z]+)/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&vanity_url=$1 [L,QSA]
RewriteRule ^myprofile/([A-Za-z]+)\/?$ mvc_handler.php?dir=User&controller=UserProfile&action=profile&profile_type=private [L,QSA]
RewriteRule ^myprofile/qanda/(q|sq|a)\/? mvc_handler.php?dir=User&controller=UserProfile&action=profile&profile_type=private&voices_type=$2 [L,QSA]
RewriteRule ^profile/badge/([0-9]+)/([a-z0-9_]+)\.([a-z0-9_]+)$ mvc_handler.php?dir=User&controller=UserProfile&action=profile_badge_image&user_id=$1&filename=$2.$3 [L,QSA]

# ==================|
# Profile 3.0 Rules |
# ==================|
#
# AJAX Pathways
# -------------
RewriteRule ^dossier/_ajax/review_flag\/?      mvc_handler.php?dir=Dossier&controller=DossierAjax&action=review_flag [L,QSA]
RewriteRule ^dossier/_ajax/response_flag\/?    mvc_handler.php?dir=Dossier&controller=DossierAjax&action=review_flag [L,QSA]
RewriteRule ^dossier/_ajax/review\/([0-9]+)\/? mvc_handler.php?dir=Dossier&controller=DossierAjax&action=get_review&review_id=$1 [L,QSA]
RewriteRule ^dossier/_ajax/add_review\/?       mvc_handler.php?dir=Dossier&controller=DossierAjax&action=add_review [L,QSA]
RewriteRule ^dossier/_ajax/email_share\/?      mvc_handler.php?dir=Dossier&controller=DossierEmails&action=email_share [L,QSA]
RewriteRule ^dossier/_ajax/contact\/?          mvc_handler.php?dir=Dossier&controller=DossierEmails&action=contact_email [L,QSA]
RewriteRule ^dossier/_ajax/([0-9]+)/([^/]+)\/? mvc_handler.php?dir=Dossier&controller=DossierAjax&action=main&id=$1&focus=$2 [L,QSA]
#
# User ID direct access: only the user id is provided (this may not be a good idea actually)
# ---------------------------------------------------
RewriteRule ^dossier/([0-9]+)\/?(overview|reviews|listings|about|activity)?\/?$ mvc_handler.php?dir=Dossier&controller=Dossier&action=redirect_from_id&id=$1&focus=$2 [L,QSA]
#
# Vanity Short URL access: a vanity url is provided
# -------------------------------------------------
RewriteRule ^dossier/([A-Za-z0-9_]+)\/?(overview|reviews|listings|about|activity)?\/?$ mvc_handler.php?dir=Dossier&controller=Dossier&action=vanity&vanity_url=$1&focus=$2 [L,QSA]
#
# SEO-formatted access for Pro users using hard-coded UserProStatusTypes
# ----------------------------------------------------------------------
RewriteRule ^dossier/.*-(?:agent|mortgage-broker-or-lender|appraiser|broker|builder|community|contractor|home-inspector|landlord|other|property-manager|real-estate-pro|stager|unknown)-(?:.*-)?([a-z]{2}|[0-9]{5})-([0-9]+)\/?([a-z0-9-]+)?\/?$ mvc_handler.php?dir=Dossier&controller=Dossier&action=route&location=$1&id=$2&focus=$3 [L,QSA]
#
# SEO-formatted access for Non-pro users using hard-coded UserStatusTypes
# -----------------------------------------------------------------------
RewriteRule ^dossier/.*-(?:home-buyer|both-buyer-and-seller|home-owner|other|renter|home-seller)-.*-([a-z]{2}|[0-9]{5})-([0-9]+)(?:\/?([a-z0-9-]+)?\/?)?$ mvc_handler.php?dir=Dossier&controller=DossierNonPro&action=route&location=$1&id=$2&focus=$3 [L,QSA]
#
# SEO-formatted access: Anything left over with at least one hyphen before a numeric user id
# ------------------------------------------------------------------------------------------
RewriteRule ^dossier/(.*-.*?)+([0-9]+)\/?(overview|reviews|listings|about|activity)?\/?$ mvc_handler.php?dir=Dossier&controller=Dossier&action=route&id=$2&seo_info=$1 [L,QSA]
#
# Email Landing Pages
# -------------------
# Keeping this for old review verification emails - this should only be uncommented if Profiles 3.0 is live as it will conflict with the existing rule for recommendation verifications
#RewriteRule ^recommendation/verification/(approve|decline)/(.*)/?$ mvc_handler.php?dir=Dossier&controller=Dossier&action=review_verification&decision=$1&code=$2 [L,QSA]
# New route with new emails for review verification
RewriteRule ^review/verification/(approve|decline)/(.*)/?$ mvc_handler.php?dir=Dossier&controller=Dossier&action=review_verification&decision=$1&code=$2 [L,QSA]
# ==========================|
# Private Profile 3.0 Rules |
# ==========================|
# AJAX Pathways
# -------------
RewriteRule ^mydossier/_ajax/save\/?                    mvc_handler.php?dir=Dossier&controller=DossierAjax&action=save_profile_piece [L,QSA]
RewriteRule ^mydossier/_ajax/vanity\/?                  mvc_handler.php?dir=Dossier&controller=DossierAjax&action=save_vanity [L,QSA]
RewriteRule ^mydossier/_ajax/review_request\/?          mvc_handler.php?dir=Dossier&controller=DossierAjax&action=review_request [L,QSA]
RewriteRule ^mydossier/_ajax/delete\/?                  mvc_handler.php?dir=Dossier&controller=DossierAjax&action=delete_profile_piece [L,QSA]
RewriteRule ^mydossier/_ajax/solicit_reviews\/?         mvc_handler.php?dir=Dossier&controller=DossierAjax&action=solicit_reviews [L,QSA]
RewriteRule ^mydossier/_ajax/review_response\/?         mvc_handler.php?dir=Dossier&controller=DossierAjax&action=review_response [L,QSA]
RewriteRule ^mydossier/_ajax/add_vicarious_review\/?    mvc_handler.php?dir=Dossier&controller=DossierAjax&action=add_vicarious_review [L,QSA]
RewriteRule ^mydossier/_ajax/remove_vicarious_review\/? mvc_handler.php?dir=Dossier&controller=DossierAjax&action=remove_vicarious_review [L,QSA]
RewriteRule ^mydossier/_ajax/resend_verification\/?     mvc_handler.php?dir=Dossier&controller=DossierAjax&action=resend_verification [L,QSA]
#
# Regular Access Pathways
# -----------------------
RewriteRule ^mydossier/?(overview|reviews|listings|about|activity)?/?$ mvc_handler.php?dir=Dossier&controller=MyDossier&action=route&focus=$1 [L,QSA]


#BSAE-2879
RewriteRule ^buildmyprofile/? transition/

# Profile Transition
RewriteRule ^transition/?$ mvc_handler.php?dir=User&controller=UserProfileTransition&action=transition [L,QSA]
RewriteRule ^transition/([0-9]+)/?$ mvc_handler.php?dir=User&controller=UserProfileTransition&action=transition&section=$1 [L,QSA]


# Biz solutions agents
# Profile Sweeps
RewriteRule ^driveithome/?$ http://pro.truliablog.com/just-for-fun/mercedes-sweepstakes-winner/ [L,R=301]
RewriteRule ^drive/?$ http://pro.truliablog.com/just-for-fun/mercedes-sweepstakes-winner/ [L,R=301]

# Biz solutions agents
# Following line is temporary - BSAE-1515: while we rebuild the agentapp page, we are redirecting.
RewriteRule ^agentapp/?$ agents/mobile/ [L,R=302]
RewriteRule ^agents/mobile/?$ biz_solutions.php?page_name=agents_mobile_iphone [L,QSA]
RewriteRule ^agents/mobile/iphone/?$ biz_solutions.php?page_name=agents_mobile_iphone [L,QSA]
RewriteRule ^agents/mobile/android/?$ biz_solutions.php?page_name=agents_mobile_android [L,QSA]
RewriteRule ^agents/feature/.*$ truliapro/ [L,R=301]
RewriteRule ^agents/feature/terms\/?$ truliapro/terms/ [L,R=301]
# cannot has pound-fragment in .htaccess, so the redirect is done in the php
RewriteRule ^agents/client_listing_report\/?$ client_listing_report.php [L,QSA]
RewriteRule ^agents/brand_your_listings\/?$ agent_brand_your_listings.php [L,QSA]
RewriteRule ^agents$ agents/ [R=301,L]
RewriteRule ^agents/benefits\/?$ biz_solutions.php?page_name=agents_free
RewriteRule ^agents/?([A-Za-z_]+)?/?$ mvc_handler.php?dir=BusinessServices&controller=AgentOverview&action=$1 [L,QSA]
RewriteRule ^industry$ industry/
RewriteRule ^industry/.*$ business/ [R=301,L]
RewriteRule ^business/?$ biz_solutions.php [L,QSA]
# Biz Solutions (conversion funnel)
RewriteRule ^business/login/?$ biz_solutions.php?page_name=my&mode=login [L,QSA]
RewriteRule ^business/sign_up(?:/|/r/(.*)|)$ registration.php?type=signup&mode=pro&return_url=$1 [QSA]
RewriteRule ^business/forgot_password/?$ biz_solutions.php?page_name=my&name=dumass [L,QSA]
RewriteRule ^business/profile/?$ biz_solutions.php?page_name=profile [L,QSA]
RewriteRule ^business/confirmation/?$ biz_solutions.php?page_name=confirmation [L,QSA]
RewriteRule ^instant\/?$ biz_solutions.php?page_name=instant [L,QSA]
RewriteRule ^insight\/?$ biz_solutions.php?page_name=insight [L,QSA]

# TruliaPro and Trulia Local Ads
RewriteRule ^business_services/trulia_pro_landing/?$ mvc_handler.php?dir=BusinessServices/TruliaPro/Landing&controller=TruliaProLanding [L,QSA]
RewriteRule ^business_services/trulia_local_ads_landing/?$ localads/ [L,R=301]
RewriteRule ^business_services/(.*)/?$ mvc_handler.php?dir=BusinessServices&controller=BusinessServices&action=$1 [L,QSA]
RewriteRule ^truliapro\/?$ mvc_handler.php?dir=BusinessServices/TruliaPro/Product&controller=TruliaProProduct [L,QSA]
RewriteRule ^remax/truliapro\/?$ biz_solutions.php?page_name=agents_premium&src=300004 [L,QSA]
RewriteRule ^truliapro/prosignupsuccess\/?$ biz_solutions.php?page_name=prosignupsuccess [L,QSA]
RewriteRule ^truliapro/compare\/?$ truliapro/ [R=301,L]
RewriteRule ^truliapro/promo\/?$ truliapro/ [R=301,L]
RewriteRule ^truliapro/howitworks\/?$ truliapro/ [R=301,L]
RewriteRule ^truliapro/terms\/?$ ad/terms/ [R=301,L]
RewriteRule ^truliapro/exitsurveysuccess\/?$ trulia_pro_signup_exit_survey_success.php [L,QSA]
RewriteRule ^agentreferral/terms\/?$ mvc_handler.php?dir=BusinessServices/AgentReferral/&controller=AgentReferral&action=terms [L,QSA]
#Mobile ads
 RewriteRule ^mobileads/?$ mvc_handler.php?dir=BusinessServices/TruliaMobileAds/Landing&controller=TruliaMobileAdsLanding [L,QSA]
# new billing pages
RewriteRule ^prosignup/?$ trulia_pro_signup.php [L,QSA]
RewriteRule ^prosignup/billing/?$ trulia_pro_signup_billing_info.php [L,QSA]
RewriteRule ^prosignup/new/?$ trulia_pro_signup_create_account.php [L,QSA]
RewriteRule ^prosignup/password/?$ trulia_pro_signup_send_password.php [L,QSA]
RewriteRule ^prosignup/faq/?$ trulia_pro_signup.php?page=faq [L,QSA]
RewriteRule ^prosignup/billinginfo/?$ mvc_handler.php?dir=BusinessServices/TruliaPro/Billing&controller=TruliaProBilling&action=trulia_pro_billing [L,QSA]
RewriteRule ^prosignup/submit/?$ mvc_handler.php?dir=BusinessServices/TruliaPro/Billing&controller=TruliaProBilling&action=submit [L,QSA]
# On boarding
RewriteRule ^onboarding/trulia_mobile_ads/([^\/]+)(/([^\/]+))?/?$ mvc_handler.php?dir=OnBoarding/TruliaLocalAds&controller=TruliaLocalAdsOnBoarding&action=$1&step=$3 [L,QSA]
RewriteRule ^onboarding/trulia_mobile_ads/?$ mvc_handler.php?dir=OnBoarding/TruliaLocalAds&controller=TruliaLocalAdsOnBoarding&action=step [L,QSA]

RewriteRule ^onboarding/trulia_local_ads/([^\/]+)(/([^\/]+))?/?$ mvc_handler.php?dir=OnBoarding/TruliaLocalAds&controller=TruliaLocalAdsOnBoarding&action=$1&step=$3 [L,QSA]
RewriteRule ^onboarding/trulia_local_ads/?$ mvc_handler.php?dir=OnBoarding/TruliaLocalAds&controller=TruliaLocalAdsOnBoarding&action=step [L,QSA]

# Product API
RewriteRule ^product/cart/calculate/?$ mvc_handler.php?dir=Product&controller=ProductCart&action=calculate [L,QSA]
RewriteRule ^product/cart/([^\/]+)/?$ mvc_handler.php?dir=Product&controller=ProductCart&action=get_cart&user_id=$1 [L,QSA]
RewriteRule ^product/available/([^\/]+)/?$ mvc_handler.php?dir=Product&controller=ProductAvailability&action=available&product_type=$1 [L,QSA]

# Subscription API
RewriteRule ^subscription/([A-Za-z_]+)/?$ mvc_handler.php?dir=Subscription&controller=SubscriptionAPI&action=$1 [L,QSA]
RewriteRule ^subscription/trulia_pro/preview/?$ mvc_handler.php?dir=BusinessServices/TruliaPro/Billing&controller=TruliaProBilling&action=preview [L,QSA]
RewriteRule ^subscription/callback/([A-Za-z_]+)/? mvc_handler.php?dir=Subscription&controller=Callback&action=$1 [L,QSA]

RewriteRule ^onboarding/trulia_pro/([^\/]+)(/([^\/]+))?/?$ mvc_handler.php?dir=OnBoarding/TruliaLocalAds&controller=TruliaProOnBoarding&action=$1&step=$3 [L,QSA]
RewriteRule ^onboarding/trulia_pro/?$ mvc_handler.php?dir=OnBoarding/TruliaLocalAds&controller=TruliaProOnBoarding&action=step [L,QSA]

RewriteRule ^success_stories/?([A-Za-z_]+)?/?$ mvc_handler.php?dir=BusinessServices/SuccessStories&controller=SuccessStories&action=$1 [L,QSA]
# Publishers redirects
RewriteRule ^affiliates\/?$ publishers/partner [R=301,L]
RewriteRule ^publishers\/?$ advertisers/ [R=301,L]
RewriteRule ^publishers/thanks.*$ biz_solutions.php?page_name=thanks [L,QSA]
RewriteRule ^publishers/platform/thanks\/? biz_solutions.php?page_name=thanks [L,QSA]
RewriteRule ^publishers/platform\/?$ biz_solutions.php?page_name=partners_publisher [L,QSA]
RewriteRule ^publishers/partner\/?$ biz_solutions.php?page_name=partners_affiliate [L,QSA]
RewriteRule ^publishers/affiliates\/?$ affiliates/ [R=301,L]
#Explore
RewriteRule ^explore\/?$ explore_index.php
#Mobile
RewriteRule ^mobile(?:(/[^\/]+))?$ mobile$1/ [L,R=301]
RewriteRule ^mobile/r/([^\/]+)/(.*)$ mobile_redirect.php?type=$1&url=$2 [QSA]
RewriteRule ^mobile/phone-settings\/?$ mobile/ [L,R=302]

RewriteRule ^mobile/ipad/r/(.*)$ mobile_static.php?page=ipad&url=$1 [QSA]
RewriteRule ^mobile/ipadrental/r/(.*)$ mobile_static.php?page=ipadrental&url=$1 [QSA]
#RewriteRule ^mobile(?:/([^\/]+))?/$ mobile_static.php?page=$1 [QSA]
RewriteRule ^mobile/ipad/$ mobile_static.php?page=ipad [L,QSA]

#RewriteRule ^mobile/ipad/r/(.*)$ mvc_handler.php?dir=Basic&controller=MobileApps&action=index&page=ipad&url=$1 [QSA]
RewriteRule ^mobile(?:/([^\/]+))?/$ mvc_handler.php?dir=Basic&controller=MobileApps&action=index&page=$1 [QSA]
#RewriteRule ^mobile/ipad/$ mvc_handler.php?dir=Basic&controller=MobileApps&action=index&page=ipad [L,QSA]

# Redirect ipad traffic from realestate.com to redirect interstitial
RewriteRule ^realestate.com-mobile-redirect/?$ m_dispatcher.php?_module=Redirect&partner=realestate.com&config=autoRedirect-disabled

#Cobrand Framed Redirects
RewriteRule ^partner\/$ cobrand_redirect.php

RewriteRule ^news$ news/
RewriteRule ^news/([^/]*)?/?$ http://info.trulia.com/index.php?s=38 [R=301,L]
RewriteRule ^trulia_trends$ trulia_trends/
RewriteRule ^trulia_trends/$ http://info.trulia.com/index.php?s=41 [R=301,L]

############# Help page RULES ###########
RewriteRule ^help/?$ https://trulia.zendesk.com/hc/en-us [L,R=301]
RewriteRule ^leave_feedback(.*)$ help/ask/ [L,R=301]
RewriteRule ^help/ask/$ mvc_handler.php?dir=Basic&controller=HelpStatic&action=zendesk_contact_form [L,QSA]
RewriteRule ^help/ask/thanks/?$ feedback.php?show_thanks=yes [L,QSA]
RewriteRule ^help/ask/process/?$ feedbackform-action.php [L,QSA]
RewriteRule ^help/(.+)$ help/ [R=301]

############# TOOLS n' WIDGETS RULES ############
RewriteRule ^widgets/?$ tools/ [L,R=301]
RewriteRule ^homeroll$ homeroll/
RewriteRule ^truliamap/?$ tools/map/ [L,R=301]
RewriteRule ^wizard/?$ tools/homeroll/ [L,R=301]
RewriteRule ^wizard/voices/?$ tools/voices/ [L,R=301]

# Redirect old widget pages to the new widget pages
RewriteRule ^tools/calculator/?$ tools/affordability-calculator/ [L,R=301]
RewriteRule ^tools/carousel/?$ tools/home-gallery/ [L,R=301]
RewriteRule ^tools/chart/?$ tools/ [L,R=301]
RewriteRule ^tools/homeroll/?$ tools/ [L,R=301]
RewriteRule ^tools/listings-map/?$ tools/map-search/ [L,R=301]
RewriteRule ^tools/map/?$ tools/map-search/ [L,R=301]
RewriteRule ^tools/ministats/?$ tools/ [L,R=301]
RewriteRule ^tools/rentalstats/?$ tools/rental-market-monitor/ [L,R=301]
RewriteRule ^tools/searchbox/?$ tools/home-finder/ [L,R=301]
RewriteRule ^tools/slideshow/?$ tools/home-showcase/ [L,R=301]
RewriteRule ^tools/snapshot/?$ tools/ [L,R=301]
RewriteRule ^tools/stats/?$ tools/market-monitor/ [L,R=301]
RewriteRule ^tools/voices/?$ tools/expert-community-advice/ [L,R=301]

# Legacy tools urls
RewriteRule ^tools/graphs(.*) tools/chart$1 [L,R=301]
RewriteRule ^tools/buttons/profile/?$ tools/ambassador/ [L,R=301]
RewriteRule ^tools/buttons/?$ tools/badge/ [L,R=301]
RewriteRule ^tools/crime/?$ mvc_handler.php?show_header=0&show_footer=0&dir=Basic&controller=Static&action=html&static_template=location_pages/crime_widget.tpl

## New Widgets ##
RewriteRule ^tools/rent-vs-buy-calculator/([A-Za-z]+)?$ mvc_handler.php?dir=TruliaTool&controller=RentVsBuyTool&action=$1 [L,QSA]
RewriteRule ^tools/home-gallery/([A-Za-z]+)?$ mvc_handler.php?dir=TruliaTool&controller=CarouselTool&action=$1 [L,QSA]
RewriteRule ^tools/market-monitor/([A-Za-z]+)?$ mvc_handler.php?dir=TruliaTool&controller=StatsTool&action=$1 [L,QSA]
RewriteRule ^tools/rental-market-monitor/([A-Za-z]+)?$ mvc_handler.php?dir=TruliaTool&controller=RentalStatsTool&action=$1 [L,QSA]
RewriteRule ^tools/home-showcase/([A-Za-z]+)?$ mvc_handler.php?dir=TruliaTool&controller=SlideShowTool&action=$1 [L,QSA]
RewriteRule ^tools/affordability-calculator/([A-Za-z]+)?$ mvc_handler.php?dir=TruliaTool&controller=CalculatorTool&action=$1 [L,QSA]
RewriteRule ^tools/home-finder/([A-Za-z]+)?$ mvc_handler.php?dir=TruliaTool&controller=SearchBoxTool&action=$1 [L,QSA]
RewriteRule ^tools/expert-community-advice/([A-Za-z]+)?$ mvc_handler.php?dir=TruliaTool&controller=VoicesTool&action=$1 [L,QSA]
RewriteRule ^tools/map-search/([A-Za-z0-9_]+)?/?$ mvc_handler.php?dir=TruliaTool&controller=ListingsMapTool&action=$1 [L,QSA]
RewriteRule ^tools/local-info-map/?([A-Za-z0-9_]+)?$ mvc_handler.php?dir=TruliaTool&controller=LocalInfoMapTool&action=embedded [L,QSA]

# Tools home page
RewriteRule ^tools$ tools/ [L,R=301]
RewriteRule ^tools/$ tools_index.php

# TruliaRSS and Badges
RewriteRule ^tools/badge/?$ tools_generic_index.php?toolId=badge [QSA]
RewriteRule ^tools/ambassador/?$ tools_generic_index.php?toolId=ambassador [QSA]
RewriteRule ^tools/rss/?$ tools_generic_index.php?toolId=rss [QSA]

################################### OLD WIDGET EMBEDS ####################################
## These rules allow the old widgets that were embedded to other sites to keep working. ##
RewriteRule ^homeroll(/tpp_([^\/]+))?(/client_([A-Za-z0-9_]+))?(/style_([A-Za-z0-9_]+))?(/.+) tool_homeroll_widget.php?tpp=$2&client=$4&style=$6&url=$7
RewriteRule ^tools/calculator(?:/id_([^\/]+))?(?:/client_([A-Za-z0-9_]+))?(?:/style_([A-Za-z0-9_]+))?(?:/tpp_([A-Za-z0-9_\-]+))?(?:/type_([A-Za-z0-9_]+))?(/.+)$ tools_calculator_widget.php?id=$1&client=$2&style=$3&tpp=$4&type=$5&url=$6
RewriteRule ^tools/badge(?:/id_([^\/]+))?(?:/client_([A-Za-z0-9_]+))?(?:/style_([A-Za-z0-9_]+))?(?:/tpp_([A-Za-z0-9_\-]+))?(?:/type_([A-Za-z0-9_]+))?/([^\/]+).png$ tools_badge_widget.php?id=$1&client=$2&style=$3&tpp=$4&type=$5&struct=$6
RewriteRule ^tools/header(?:/id_([^\/]+))?(?:/client_([A-Za-z0-9_]+))?(?:/style_([A-Za-z0-9_]+))?(?:/tpp_([A-Za-z0-9_\-]+))?(/.+)$ tools_header_widget.php?id=$1&client=$2&style=$3&tpp=$4&url=$5
RewriteRule ^tools/footer(?:/id_([^\/]+))?(?:/client_([A-Za-z0-9_]+))?(?:/style_([A-Za-z0-9_]+))?(?:/tpp_([A-Za-z0-9_\-]+))?(/.+)$ tools_footer_widget.php?id=$1&client=$2&style=$3&tpp=$4&url=$5
RewriteRule ^tools/carousel(?:/id_([^\/]+))?(?:/client_([A-Za-z0-9_]+))?(?:/style_([A-Za-z0-9_]+))?(?:/tpp_([A-Za-z0-9_\-]+))?(/.+)$ tools_carousel_widget.php?id=$1&client=$2&style=$3&tpp=$4&url=$5
RewriteRule ^tools/slideshow(?:/id_([^\/]*))?(?:/client_([A-Za-z0-9_]+))?(?:/style_([A-Za-z0-9_]+))?(?:/tpp_([A-Za-z0-9_\-]+))?(?:/type_([A-Za-z0-9_]+))?(/.+)$ tools_slideshow_widget.php?id=$1&client=$2&style=$3&tpp=$4&type=$5&url=$6
RewriteRule ^tools/ministats(?:/id_([^\/]+))?(?:/client_([A-Za-z0-9_]+))?(?:/style_([A-Za-z0-9_]+))?(?:/tpp_([A-Za-z0-9_\-]+))?(/.+)$ tools_ministats_widget.php?id=$1&client=$2&style=$3&tpp=$4&url=$5
# TruliaChart widget
RewriteCond %{REQUEST_URI} !tools/chart/graph.png
RewriteRule ^tools/chart(?:/id_([^\/]+))?(?:/client_([A-Za-z0-9_]+))?(?:/style_([A-Za-z0-9_]+))?(?:/tpp_([A-Za-z0-9_\-]+))?(?:/type_([A-Za-z0-9_]+))?(/.+)$ tools_chart_widget.php?id=$1&client=$2&style=$3&tpp=$4&type=$5&url=$6
# TruliaRentalStats widget
RewriteRule ^tools/rentalstats/rental_price_index.js?$ mvc_handler.php?dir=BusinessServices&controller=RentalStatsWidget&action=widget [QSA,L]
RewriteRule ^tools/rentalstats/rental_price_index$ mvc_handler.php?dir=BusinessServices&controller=RentalStatsWidget&action=widget [QSA,L]
# TruliaListingsMap widget
RewriteRule ^tools/listings-map/([A-Za-z0-9_]+)?/?$ mvc_handler.php?dir=BusinessServices&controller=ListingsMapWidget&action=$1 [QSA,L]

RewriteRule ^about/professionals/?$ biz_solutions.php?page_name=about [L,QSA]
RewriteRule ^jobs/?$ about/careers [L,R=301]
RewriteRule ^aboutus/$ about [L,R=301]
RewriteRule ^about(.*)/$ about$1 [L,R=301]
RewriteRule ^about$ mvc_handler.php?dir=About&controller=About&action=index [L,QSA]
RewriteRule ^about/([^/]*)$ mvc_handler.php?dir=About&controller=About&action=$1 [L,QSA]
RewriteRule ^about/([^/]*)/([^/]*)$ mvc_handler.php?dir=About&controller=About&action=$1&category=$2 [L,QSA]
RewriteRule ^about/([^/]*)/([^/]*)/([^/]*)$ mvc_handler.php?dir=About&controller=About&action=$1&category=$2&subcategory=$3 [L,QSA]
RewriteRule ^about/([^/]*)/([^/]*)/([^/]*)/([^/]*)$ mvc_handler.php?dir=About&controller=About&action=$1&category=$2&subcategory=$3&item=$4 [L,QSA]

RewriteRule ^link$ http://info.trulia.com/index.php?s=63 [R=301]
RewriteRule ^link/.*$ http://info.trulia.com/index.php?s=63 [R=301]
RewriteRule ^faq$ help/ [R=301]
RewriteRule ^faq/.*$ help/ [R=301]
#RewriteRule ^jobs$ jobs/
#RewriteRule ^jobs/.*$ hiring.php
#RewriteRule ^jobs\/?$ http://careers2.hiredesk.net/ViewJobs/?Comp=Trulia&sPERS_ID=&tp_id=1&JB_ID [L,R=301]
RewriteRule ^truth$ truth/
RewriteRule ^truth/.*$ business/ [R=301,L]

RewriteRule ^management$ management/
RewriteRule ^management/.*$ about/people/ [L,R=301]

# quick connect landing page
RewriteRule ^quick_connect\/?$ directory/ [L,QSA]

# advertising pages
RewriteRule ^network\/?$ biz_solutions.php?page_name=partners_overview
RewriteRule ^advertisers\/?$ biz_solutions.php?page_name=partners_overview
RewriteRule ^realogy\/?$ biz_solutions.php?page_name=brokers&campaign=realogy [L,QSA]

RewriteRule ^advertisers/brokers/premium\/?$ biz_solutions.php?page_name=brokers_premium [L,QSA]
RewriteRule ^advertisers/brokers\/?$ biz_solutions.php?page_name=brokers [L,QSA]

# Forwarding rentals traffic to new landing page
RewriteRule ^rentals\/?$ post-rental/ [R=301,L]

RewriteRule ^advertisers/agents\/?$ truliapro/ [L,R=301]
RewriteRule ^advertisers/network\/?$ biz_solutions.php?page_name=partners_advertisers [L,QSA]
RewriteRule ^advertisers/network/thanks\/? biz_solutions.php?page_name=thanks [L,QSA]
RewriteRule ^realtyalliance.*$ advertisers/brokers/ [R=301,L]
RewriteRule ^promo/(.*)$ advertisers/ [R=301,L]
RewriteRule ^thanks_(agent|broker|mls|rentals)$ thanks_$1/
RewriteRule ^thanks_(agent|broker|mls|rentals)/.*$ biz_solutions.php?page_name=thanks [QSA,L]
# end advertising pages

RewriteRule ^contact$ contact/
RewriteRule ^contact/.*$ contactus.php
RewriteRule ^submit_site$ submit_site/
RewriteRule ^submit_site/.*$ submit_listings/site/ [R=301,L]
RewriteRule ^terms/advertisers?\/?$ termsandconditions_advertiser.php
RewriteRule ^terms$ terms/
RewriteRule ^terms/.*$ mvc_handler.php?dir=Legal&controller=TermsPage&action=index
RewriteRule ^feed_terms$ feed_terms/
RewriteRule ^feed_terms/.*$ mvc_handler.php?dir=Legal&controller=FeedTermsPage&action=index
RewriteRule ^privacy$ privacy/
RewriteRule ^privacy/.*$ mvc_handler.php?dir=Legal&controller=PrivacyPage&action=index

# Builder Community-Details-Page (CDP)
RewriteRule ^builder-community/(.+)-([A-Za-z0-9]+)/?$ mvc_handler.php?dir=PDP&controller=PDP&action=cdp&propertyId=$2&community_name=$1&status=For+Sale [QSA,L]
RewriteRule ^builder-community/([A-Za-z0-9]+)/?$ mvc_handler.php?dir=PDP&controller=PDP&action=cdp&propertyId=$1&status=For+Sale [QSA,L]

#community details page
RewriteRule ^rental-community/([0-9]+)/(.+)-([A-Z]{2})(-[0-9]+)?/?$ mvc_handler.php?dir=PDP&controller=PDP&action=index&propertyId=$1&seoaddress=$2&stateCode=$3&status=For+Rent&propcode=rental&zipCodePiece=$4 [QSA]
RewriteRule ^rental-community/([0-9]+)$ rental-community/$1/ [QSA]
# seems like doesn't work
RewriteRule ^rental-community/*$ mvc_handler.php?dir=Home&controller=Homepage&ptype=for_rent [QSA,L]

# New Crosspost - handles both sls and property, for both for-sale and rental.
RewriteRule ^crosspost/rental/sls/([0-9]+)?(.*)$ mvc_handler.php?dir=Crosspost&controller=Crosspost&sls_id=$1&search_type=for+rent [QSA,L]
RewriteRule ^crosspost/forsale/sls/([0-9]+)?(.*)$ mvc_handler.php?dir=Crosspost&controller=Crosspost&sls_id=$1&search_type=for+sale [QSA,L]
RewriteRule ^crosspost/rental/property/([0-9]+)?(.*)$ mvc_handler.php?dir=Crosspost&controller=Crosspost&property_id=$1&search_type=for+rent [QSA,L]
RewriteRule ^crosspost/forsale/property/([0-9]+)?(.*)$ mvc_handler.php?dir=Crosspost&controller=Crosspost&property_id=$1&search_type=for+sale [QSA,L]

# Trulia Example Controller - only available to dev.
RewriteRule ^example/([0-9]+)(.*)$ mvc_handler.php?dir=Example&controller=Example&some_id=$1 [QSA,L]
RewriteRule ^example/secondary/([0-9]+)(.*)$ mvc_handler.php?dir=Example&controller=Example&action=secondary&some_id=$1 [QSA,L]
RewriteRule ^example/map/([0-9]+)(.*)$ mvc_handler.php?dir=Example&controller=Example&action=map&some_id=$1 [QSA,L]

# rule to handle /property/12345- (missing address; property id followed by dash followed by nothing) urls
# instead of 404, redirect to home page
RewriteRule ^property/([0-9]+)-$ /?error_code=7 [R=301,L]

# Redirect comps pages to associated PDPs (louisb, 2014-05-23)
#
## We pass the majority of the work to the PDP controller, as it checks for canonical addresses
## Active property URLs are easy
RewriteRule ^home_values/for_sale/[A-Za-z]{2}/[-A-Za-z0-9_\+\'%\ \,\(\)\.]+/[0-9]{5}/([0-9]+)/?$ property/$1
RewriteRule ^home_values/for_sale/[A-Za-z]{2}/[-A-Za-z0-9_\+\'%\ \,\(\)\.]+/([0-9]+)/?$ property/$1
#
## Assessor property URLs involve more faking -- we substitute state code for state ($1) and
## fake the SEO address ("--"), both of which are handled somewhat gracefully in PDPController.
RewriteRule ^home_values/sold/([A-Za-z]{2})/([-A-Za-z0-9_\+\'%\ \,\(\)\.]+)/[0-9]{5}/([0-9]+)/?$ homes/$1/$2/sold/$3--
RewriteRule ^home_values/sold/([A-Za-z]{2})/([-A-Za-z0-9_\+\'%\ \,\(\)\.]+)/([0-9]+)/?$ homes/$1/$2/sold/$3--

# Active-only index
#/property/propertyId
RewriteRule ^property/([0-9]+)$ mvc_handler.php?dir=PDP&controller=PDP&action=index&propertyId=$1&status=For+Sale [QSA,L]
#/property/propertyId/stuffwedontcareabout
RewriteRule ^property/([0-9]+)/.*$ mvc_handler.php?dir=PDP&controller=PDP&action=index&propertyId=$1&status=For+Sale [QSA,L]
#/property/propertyId-123-Hi-Street-CA - this is our target url for for sale pdps
RewriteRule ^property/([0-9]+)-(.+)-([FSA])([A-Z][A-Z])$ mvc_handler.php?dir=PDP&controller=PDP&action=index&propertyId=$1&seoaddress=$2&propcode=$3&stateCode=$4&status=For+Sale [QSA,L]
#/property/propertyId-123-Hi-Street
RewriteRule ^property/([0-9]+)-(.+)$ mvc_handler.php?dir=PDP&controller=PDP&action=index&propertyId=$1&seoaddress=$2&status=For+Sale [QSA,L]
#/property/-(seo address)
RewriteRule ^property/-(.*)$ mvc_handler.php?dir=PDP&controller=PDP&action=index&seoaddress=$1&status=For+Sale [QSA,L]

#Rentals
RewriteRule ^rental/([0-9]+)$ mvc_handler.php?dir=PDP&controller=PDP&action=index&propertyId=$1&propcode=rental&status=For+Rent [QSA,L]
RewriteRule ^rental/([0-9]+)-(.+)$ mvc_handler.php?dir=PDP&controller=PDP&action=index&propertyId=$1&seoaddress=$2&propcode=rental&status=For+Rent [QSA,L]
RewriteRule ^rental/-(.*)$ mvc_handler.php?dir=PDP&controller=PDP&action=index&seoaddress=$1&propcode=rental&status=For+Rent [QSA,L]

# Rental Listing Management
RewriteRule ^manage-listing/(remove)/(\d+)/([^/]+)/([0-9a-f]{40})/([0|1])$ mvc_handler.php?controller=RemoveListing&dir=ListingManagement&action=index&listing_action=$1&property_id=$2&property_status=$3&token=$4&confirmed=$5 [L,QSA]
RewriteRule ^manage-listing/(block|unblock)/(\d+)/([^/]+)/([0-9a-f]{40})/([0|1])$ mvc_handler.php?controller=RemoveListing&dir=ListingManagement&action=confirm&listing_action=$1&property_id=$2&property_status=$3&token=$4&confirmed=$5 [L,QSA]

# Email Follow-up Response
 RewriteRule ^email-followup-response/(X|Y)/(\d+)/(\d+)$ mvc_handler.php?dir=Email&controller=EmailFollowupResponse&action=log_response&claim=$1&property_id=$2&lead_id=$3 [L,QSA]

# Assessor properties
# /homes/california/San_Francisco/sold/30059075-2810-Laguna-St-San-Francisco-CA-94123/
RewriteRule ^homes/([A-Za-z_]+)/([A-Za-z0-9_\+\'%\ \,\(\)\.\-]+)/sold/([0-9]+)-(.+)$ mvc_handler.php?dir=PDP&controller=PDP&action=index&state=$1&propcode=sold&city=$2&propertyId=$3&seoaddress=$4&status=Sold [QSA]

RewriteRule ^rentals/([0-9]+)(-.*)?$ mvc_handler.php?dir=PDP&controller=PDP&action=index&propertyId=$1&seoaddress=$2&propcode=rental [QSA]
RewriteRule ^foreclosure/([0-9]+)(-.*)?$ mvc_handler.php?dir=PDP&controller=PDP&action=index&propertyId=$1&seoaddress=$2&propcode=foreclosure [QSA,L]
# seems like doesn't work
RewriteRule ^property/*$ mvc_handler.php?dir=Home&controller=Homepage [QSA,L]

#Redirect all old PDP tabs to new single-page URLs
RewriteRule ^property/(?:agent|compare|features|floorplan|local|map|photos|price|schools)/([0-9]+)-(.+)$ property/$1-$2 [R=301,L]
RewriteRule ^homes/(?:agent|compare|features|floorplan|local|map|photos|price|schools)/([A-Za-z_]+)/([A-Za-z0-9_\+\'%\ \,\(\)\.]+)/sold/([0-9]+)-(.+)$ homes/$1/$2/sold/$3-$4 [R=301,L]
RewriteRule ^foreclosure/(?:agent|compare|features|floorplan|local|map|photos|price|schools)/([0-9]+)(-.*)?$ foreclosure/$1$2 [R=301,L]
RewriteRule ^rental/(?:agent|compare|features|floorplan|local|map|photos|price|schools)/([0-9]+)(-.*)?$ rental/$1$2 [R=301,L]

# Mortgage Marketplace
RewriteRule ^(mortgages|loan)/$ mvc_handler.php?dir=Mortgage&controller=Results&action=index&page_type=$1 [L,QSA]
RewriteRule ^(mortgages|loan)/(.+),([A-Za-z]{2})/?$ mvc_handler.php?dir=Mortgage&controller=Results&action=index&page_type=$1&city=$2&state_code=$3 [L,QSA]
RewriteRule ^(mortgages|loan)/([A-Za-z]{2})/?$ mvc_handler.php?dir=Mortgage&controller=Results&action=index&page_type=$1&state_code=$2 [L,QSA]
RewriteRule ^mortgages/quote/([\w-]+)$ mvc_handler.php?dir=Mortgage&controller=DetailPage&action=index&quote_id=$1 [L,QSA]
RewriteRule ^mortgages/track/([\w-]+)$ mvc_handler.php?dir=Mortgage&controller=DetailPage&action=track&quote_id=$1 [L,QSA]
RewriteRule ^mortgages/quote/send/$ mvc_handler.php?dir=Mortgage&controller=DetailPage&action=send_lead [L,QSA]
# TODO: rename this url
RewriteRule ^mortgages/quote/send/no_quote/$ mvc_handler.php?dir=Mortgage&controller=DetailPage&action=send_lead_no_quote [L,QSA]
RewriteRule ^mortgages/ajax$ mvc_handler.php?dir=Mortgage&controller=Prototype&action=ajax [L,QSA]
RewriteRule ^mortgages/widget/location$ mvc_handler.php?dir=Mortgage&controller=LocationWidget [L,QSA]
RewriteRule ^mortgages/widget/property$ mvc_handler.php?dir=Mortgage&controller=PropertyWidget [L,QSA]
RewriteRule ^mortgages/lender/link$ mvc_handler.php?dir=Mortgage&controller=LenderLink&action=ajax [L,QSA]

# Refinance
RewriteRule ^(refinance)/?$ mvc_handler.php?dir=Mortgage&controller=Results&action=index&loan_type=Refinance&page_type=$1 [L,QSA]
RewriteRule ^(refinance)/(.+),([A-Za-z]{2})/?$ mvc_handler.php?dir=Mortgage&controller=Results&action=index&page_type=$1&loan_type=Refinance&city=$2&state_code=$3 [L,QSA]
RewriteRule ^(refinance)/([A-Za-z]{2})/?$ mvc_handler.php?dir=Mortgage&controller=Results&action=index&loan_type=Refinance&page_type=$1&state_code=$2 [L,QSA]
# catch all for extra chars in the url
RewriteRule ^(mortgages|loan)/(.+),\ ?([A-Za-z]{2})/?.*$ mvc_handler.php?dir=Mortgage&controller=Results&action=index&page_type=$1&city=$2&state_code=$3 [L,QSA]
RewriteRule ^(mortgages|loan)/([A-Za-z]{2})/?.*$ mvc_handler.php?dir=Mortgage&controller=Results&action=index&page_type=$1&state_code=$2 [L,QSA]
RewriteRule ^(refinance)/(.+),\ ?([A-Za-z]{2})/?.*$ mvc_handler.php?dir=Mortgage&controller=Results&action=index&page_type=$1&loan_type=Refinance&city=$2&state_code=$3 [L,QSA]
RewriteRule ^(refinance)/([A-Za-z]{2})/?.*$ mvc_handler.php?dir=Mortgage&controller=Results&action=index&loan_type=Refinance&page_type=$1&state_code=$2 [L,QSA]

# Mortgage/Refinance/Loan - catch all for extra chars in the url and redirect to clean url
RewriteRule ^(mortgages|loan|refinance)/(.+),\ ?([A-Za-z]{2})/?.*$ $1/$2,$3/ [R=301,L]
RewriteRule ^(mortgages|loan|refinance)/([A-Za-z]{2})/?.*$ $1/$2/ [R=301,L]
RewriteRule ^(mortgages|loan|refinance)/.*$ $1/ [R=301,L]

# Mortgage sitemap
RewriteRule ^mortgage-sitemap/(([A-Za-z]{2})\/?)?$ mvc_handler.php?dir=Mortgage&controller=Sitemap&action=index&state_code=$2 [L,QSA]

# Mortgage - old/typos
RewriteRule ^mortgage[s/]?$ mortgages/ [R=301,L]
RewriteRule ^loans$ loan/ [R=301,L]
RewriteRule ^refinance$ refinance/ [R=301,L]
RewriteRule ^property/mortgage/[0-9]+-.+$ mortgages/ [R=301,L]
RewriteRule ^homes/refinance/[A-Za-z_]+/[A-Za-z0-9_\+\'%\ \,\(\)\.\-]+/sold/[0-9]+-.+$ mortgages/ [R=301,L]
RewriteRule ^mortgage-trends mortgages/ [R=301,L]

# County sitemap

RewriteRule ^county-sitemap(\/(.+))?\/?$ mvc_handler.php?dir=CountySitemap&controller=CountySitemap&action=index&state_name=$2
RewriteRule ^County(\/(.+))?\/?$ mvc_handler.php?dir=SRP&controller=SRP&action=list&url=/for_sale/$2,$1/ [QSA,L]


# [old] foreclosure center page
RewriteRule ^foreclosure/([A-Z]{2})/(.+),([0-9]+),(.+)/$ for_sale/$3_nh/foreclosure_lt/ [R=301,L]
RewriteRule ^foreclosure/([A-Z]{2})/(.+)/([0-9]+)/$ for_sale/$3_zip/foreclosure_lt/ [R=301,L]
RewriteRule ^foreclosure/([A-Z]{2})/(.+)/$ for_sale/$2,$1/foreclosure_lt/ [R=301,L]
RewriteRule ^forclosure\/?$ for_sale/Las_Vegas,NV/foreclosure_lt/ [R=301,L]
RewriteRule ^foreclosure$ for_sale/Las_Vegas,NV/foreclosure_lt/ [R=301,L]
RewriteRule ^foreclosure/$ for_sale/Las_Vegas,NV/foreclosure_lt/ [R=301,L]

#claim home (home owners) edit details pages
#New forms
RewriteRule ^edit_home/calculate/$ mvc_handler.php?dir=ClaimHome&controller=ClaimHome&action=calculate [L]
RewriteRule ^edit_home/([A-Z]{2})/(.+)/$ mvc_handler.php?dir=ClaimHome&controller=ClaimHome&action=edit&state_code=$1&address_hash=$2
RewriteRule ^edit_home/rate/([A-Z]{2})/(.+)/$ mvc_handler.php?dir=ClaimHome&controller=ClaimHome&action=rate&state_code=$1&address_hash=$2 [L,QSA]

#Trulia Estimates static help page
RewriteRule ^trulia_estimates/?$ mvc_handler.php?show_header=1&show_footer=1&dir=Basic&controller=Static&action=html&static_template=static/trulia_estimates.tpl

# Mortgage calculator page
RewriteRule ^mortgage/calculator/payment/property/([0-9]+)-(.+)$ comprehensive_mortgage_calculator.php?propertyId=$1&seoaddress=$2
RewriteRule ^mortgage/calculator/payment/classified/([0-9]+)-(.+)$ comprehensive_mortgage_calculator.php?propertyId=$1&seoaddress=$2&propcode=classified
RewriteRule ^mortgage/calculator/payment/$ comprehensive_mortgage_calculator.php

RewriteRule ^mortgage-calculators/([0-9]{2})/([^/]+)/(.+),([A-Z]{2})/?$ mortgage_calculators.php?calc_id=$1&calc_name=$2&city=$3&state_code=$4&page_level=city
RewriteRule ^mortgage-calculators/([0-9]{2})/([^/]+)/(.+)/?$ mortgage_calculators.php?calc_id=$1&calc_name=$2&state_name=$3&page_level=state
RewriteRule ^mortgage-calculators/([0-9]{2})/?([^/]+)?/?$ mortgage_calculators.php?calc_id=$1&calc_name=$2&page_level=national
RewriteRule ^mortgage-calculators/(.+),([A-Z]{2})/?$ mortgage_calculators.php?city=$1&state_code=$2&page_level=city
RewriteRule ^mortgage-calculators/(.+)/?$ mortgage_calculators.php?state_name=$1&page_level=state
RewriteRule ^mortgage-calculators$ mortgage-calculators/ [R=301,L]
RewriteRule ^mortgage-calculators/$ mortgage_calculators.php?page_level=national [L]

RewriteRule ^mortgage-advice$ mortgage-advice/ [R=301,L]
RewriteRule ^mortgage-advice/$ mvc_handler.php?dir=Mortgage&controller=Guides&action=index [L,QSA]
RewriteRule ^mortgage-advice/([^/]+)$  mortgage-advice/$1/ [R=301,L]
RewriteRule ^mortgage-advice/([^/]+)/$ mvc_handler.php?dir=Mortgage&controller=Guides&action=index&guide=$1 [L,QSA]

#rent v buy calcualtor page
RewriteRule ^rent_vs_buy/?$ mvc_handler.php?dir=RentVsBuy&controller=RentVsBuy&action=index [L,QSA]


# rule to handle /property/12345- (missing address; property id followed by dash followed by nothing) urls
# instead of 404, redirect to home page
RewriteRule ^nearby/([0-9]+)-$ /?error_code=7 [R=301,L]
RewriteRule ^nearby/([0-9]+)$ property_map.php?propertyId=$1
RewriteRule ^nearby/([0-9]+)/.*$ property_map.php?propertyId=$1
RewriteRule ^nearby/([0-9]+)-(.+)-([FSA])([A-Z][A-Z])$ property_map.php?propertyId=$1&seoaddress=$2&propcode=$3&state=$4
RewriteRule ^nearby/([0-9]+)-(.+)$ property_map.php?propertyId=$1&seoaddress=$2

#support for zoom, map type, etc
RewriteRule ^nearby/z-([0-9]+)/t-([A-Za-z_]+)/([\-0-9]+\.[0-9]+\,[\-0-9]+\.[0-9]+)/([0-9]+)-(.+)$ property_map.php?zoom_level=$1&map_view=$2&centroid=$3&propertyId=$4&seoaddress=$5
RewriteRule ^nearby/foreclosure/z-([0-9]+)/t-([A-Z_]+)/([\-0-9]+\.[0-9]+\,[\-0-9]+\.[0-9]+)/([0-9]+)-(.+)$ property_map.php?propcode=foreclosure&zoom_level=$1&map_view=$2&centroid=$3&propertyId=$4&seoaddress=$5
RewriteRule ^nearby/(classified|rental)/z-([0-9]+)/t-([A-Z_]+)/([\-0-9]+\.[0-9]+\,[\-0-9]+\.[0-9]+)/([0-9]+)-(.+)$ property_map.php?propcode=$1&zoom_level=$2&map_view=$3&centroid=$4&propertyId=$5&seoaddress=$6
RewriteRule ^nearby/sold/([A-Za-z_]+)/([A-Za-z0-9_\+\'%\ \,\(\)\.]+)/z-([0-9]+)/t-([A-Z_]+)/([\-0-9]+\.[0-9]+\,[\-0-9]+\.[0-9]+)/([0-9]+)-(.+)$ property_map.php?fstate=$1&fcity=$2&zoom_level=$3&map_view=$4&centroid=$5&fpid=$6&seoaddress=$7&propcode=sold

#show poi by default
RewriteRule ^nearby/poi/z-([0-9]+)/t-([A-Z_]+)/([\-0-9]+\.[0-9]+\,[\-0-9]+\.[0-9]+)/([0-9]+)-(.+)$ property_map.php?zoom_level=$1&map_view=$2&centroid=$3&propertyId=$4&seoaddress=$5&show_poi=1
RewriteRule ^nearby/poi/foreclosure/z-([0-9]+)/t-([A-Z_]+)/([\-0-9]+\.[0-9]+\,[\-0-9]+\.[0-9]+)/([0-9]+)-(.+)$ property_map.php?propcode=foreclosure&zoom_level=$1&map_view=$2&centroid=$3&propertyId=$4&seoaddress=$5&show_poi=1
RewriteRule ^nearby/poi/(classified|rental)/z-([0-9]+)/t-([A-Z_]+)/([\-0-9]+\.[0-9]+\,[\-0-9]+\.[0-9]+)/([0-9]+)-(.+)$ property_map.php?propcode=$1&zoom_level=$2&map_view=$3&centroid=$4&propertyId=$5&seoaddress=$6&show_poi=1
RewriteRule ^nearby/poi/sold/([A-Za-z_]+)/([A-Za-z0-9_\+\'%\ \,\(\)\.]+)/z-([0-9]+)/t-([A-Z_]+)/([\-0-9]+\.[0-9]+\,[\-0-9]+\.[0-9]+)/([0-9]+)-(.+)$ property_map.php?fstate=$1&fcity=$2&zoom_level=$3&map_view=$4&centroid=$5&fpid=$6&seoaddress=$7&propcode=sold&show_poi=1

RewriteRule ^nearby\/?(.+)$ /?error_code=7 [R=301,L]

RewriteRule ^directions/([0-9]+)$ driving_direction.php?propertyId=$1
RewriteRule ^directions/([0-9]+)/.*$ driving_direction.php?propertyId=$1
RewriteRule ^directions/([0-9]+)-(.+)-([FSA])([A-Z][A-Z])$ driving_direction.php?propertyId=$1&seoaddress=$2&propcode=$3&state=$4
RewriteRule ^directions/([0-9]+)-(.+)$ driving_direction.php?propertyId=$1&seoaddress=$2
RewriteRule ^directions/(classified|rental)/([0-9]+)-(.+)$ driving_direction.php?propertyId=$2&seoaddress=$3&propcode=$1

RewriteRule ^captcha/(.*) captcha_img.php$1
# new broker pages
RewriteRule ^connect$ connect/
RewriteRule connect/$ submit_listings/ [R=301,L]
RewriteRule ^connect/partners$ connect/partners/
RewriteRule connect/partners/$ submit_listings/ [R=301,L]
# Survey - ForeSee
RewriteRule  ^survey/i\/?$ survey_foresee.php?invite=1
RewriteRule  ^survey/t\/?$ survey_foresee.php
# Survey - SatMetrix
RewriteRule  ^survey/satmetrix$ mvc_handler.php?dir=SatMetrix&controller=SatMetrixSurvey&action=redirect

# newsletter archive
RewriteRule ^newsletter/([0-9]+)/([0-9]+)/([0-9]+)/?$ newsletter_archive.php?year=$1&month=$2&day=$3
RewriteRule ^newsletter/([0-9]+)/([0-9]+)/([A-Za-z0-9_\-\+\ \,]+)/?$ newsletter_archive.php?year=$1&month=$2&title=$3
RewriteRule ^newsletter/([0-9]+)/([0-9]+)/?$ newsletter_archive.php?year=$1&month=$2
RewriteRule ^newsletter/[^\/]+/?$ newsletter_archive.php
RewriteRule ^newsletter$ newsletter/
RewriteRule ^newsletter/$ newsletter_archive.php
# community guidelines
RewriteRule ^guidelines.* community_guidelines.php

# questions and answers
RewriteRule ^ask$ ask/ [QSA,R=301,L]
#RewriteRule ^ask/$ question_ask.php
#RewriteRule ^ask/([0-9]+).*$ question_ask.php?questionId=$1
RewriteRule ^ask/ mvc_handler.php?dir=Voices&controller=AskPage&action=index [QSA,L]
RewriteRule ^post/ mvc_handler.php?dir=Voices&controller=PostDiscussionPage&action=index [QSA,L]

# voices search sitemap
RewriteRule ^voices/top_real_estate_searches(/p_([0-9]+))?/?$ voices_search_sitemap.php?page=$2 [L,QSA]
RewriteRule ^top-real-estate-search(/p_([0-9]+))?/?$ voices_search_sitemap.php?page=$2 [L,QSA]

# find a pro -- old, delete when the new find an agent is released

# new find an agent
RewriteRule ^voices/directory/?$ directory/ [R=301,L]
RewriteRule ^voices/directory/(.*)$ directory/$1 [R=301,L]

RewriteRule ^directory$ directory/ [R=301,L]
RewriteRule ^directory/$ mvc_handler.php?dir=FindAnAgent&controller=FindAnAgentHome  [QSA,L]

# Find a pro voices/directory/
#    prefix:                       ^voices/directory/
# $1  location names (opt):          ([^\/-]*)?
# $2 lowercase_pro_status:          -?([^\/-]*)?
# $3 keyword query:                 -?-?([^\/-]+)?
# $4 location ID:                   -?([0-9]*)?
# $5 page no:                       -?(?:p_([0-9]+))?
#     optional trailing slash:       \/?$
RewriteRule ^directory/search/?$ mvc_handler.php?dir=FindAnAgent&controller=FindAnAgentResults&action=search [QSA,L]
RewriteRule ^directory/([^\/-]*)?-?([^\/-]*)?-?([^\/-]+)?-?([0-9]*)?$ directory/$1-$2-$3-$4/ [QSA,L]
RewriteRule ^directory/([^\/-]*)?-?([^\/-]*)?-?([^\/-]+)?-?([0-9]*)?/(?:([0-9]+)_p)?-*?/?\/?$ mvc_handler.php?dir=FindAnAgent&controller=FindAnAgentResults&location=$1&lowercase_pro_status=$2&keyword=$3&locationId=$4&page=$5 [QSA,L]
RewriteRule ^directory/([^\/-]*)?-?([^\/-]*)?-?([^\/-]*)?-?([^\/-]+)?-?([0-9]*)?/(?:([0-9]+)_p)?-*?/?\/?$ mvc_handler.php?dir=FindAnAgent&controller=FindAnAgentResults&location=$1&client_type=$2&lowercase_pro_status=$3&keyword=$4&locationId=$5&page=$6 [QSA,L]

# recommendations/suggestions page
RewriteRule ^suggestions/?$ account/suggestions/ [R=301,L,NC]
RewriteRule ^account/property-recommendations/?$ account/suggestions/ [R=301,L]
RewriteRule ^account/suggestions/?$ mvc_handler.php?dir=PropertyRecommendations&controller=PropertyRecommendationsIndex&action=index [QSA,L]

# about voices
RewriteRule ^voices/about/?$ voices_what_is_voices_page.php [L,QSA]

# claiming by agent
RewriteRule ^claim/agent/([0-9]+)$ claim_process.php?pid=$1 [L,QSA]

# market crisis (retired)
RewriteRule ^voices/marketcrisis/?$ /voices/ [R=301,L]

# leaderboard - legacy
#RewriteRule ^voices/leaderboard.*$ voices/directory/-pros-?sort_order=activity [R=301,L]
RewriteRule ^voices/leaderboard.*$ directory/-pros-?sort_order=activity [R=301,L]

# cool new sitemap
RewriteRule ^voices/sitemap-([^-/]+)/?$ voices_sitemap_top_level.php?filter=$1 [L,QSA]
RewriteRule ^voices/sitemap$ voices/sitemap/ [L,R=301]
RewriteRule ^voices/sitemap/$ voices_sitemap_top_level.php [L,QSA]
RewriteRule ^voices/sitemap-index-([0-9]+)/?$ voices_sitemap_content.php?page=$1 [L,QSA]
RewriteRule ^voices/sitemap-([^-]+)-([^-]+)-([0-9]+)/?$ voices_sitemap_content.php?filter=$1&category=$2&page=$3 [L,QSA]

# Short ID URLs
RewriteRule ^profile/facebook/([0-9]+)$ user_profile_facebook.php?fb_id=$1 [QSA,L]

# TRULIA HOME STORY
RewriteRule ^fb_app_trulia_home_story/?$ trulia_home_story_tab.php [QSA,L]
RewriteRule ^fb_app_trulia_home_story/fb_tab/?$ trulia_home_story_tab.php [QSA,L]
RewriteRule ^fb_app_trulia_home_story/redirectapp/?$ trulia_home_story_tab.php?redirectapp=1 [QSA,L]
RewriteRule ^fb_app_trulia_home_story/([0-9]+)\/?$ trulia_home_story_tab.php?friendpost=$1 [QSA,L]
RewriteRule ^fb_app_trulia_home_story/viewpostlanding/([0-9]+)\/?$ trulia_home_story_tab.php?viewpost=$1&viewpostlanding=1 [QSA,L]
RewriteRule ^fb_app_trulia_home_story/([A-Za-z0-9_]+)/([0-9]+)\/?$ trulia_home_story_tab.php?$1=$2 [QSA,L]
RewriteRule ^fb_app_trulia_home_story/time_line_post/([0-9]+)\/?$ trulia_home_story_time_line_post.php?home_story_id=$1 [QSA,L]
RewriteRule ^fb_app_trulia_home_story/time_line_post/([A-Za-z0-9_]+)/([0-9]+)\/?$ trulia_home_story_time_line_post.php?home_story_id=$2&action=$1 [QSA,L]

# Get current profile picture by vanity URL or their ID
RewriteRule ^profilepic/([A-Za-z0-9_]+)/?$ mvc_handler.php?dir=User&controller=UserProfile&action=get_profile_picture&vanity_url=$1 [QSA,L]
RewriteRule ^profilepic/id/([0-9]+)/?$ mvc_handler.php?dir=User&controller=UserProfile&action=get_profile_picture&user_id=$1 [QSA,L]

RewriteRule ^PhotoTagging(User)?API/(([^/]+)/?)(/([^/]+)/?)?(/([^/]+)/?)?$ mvc_handler.php?dir=PhotoTagging&controller=PhotoTagging&action=api_request&group_id=$3&pic_id=$5&tag=$7&user_submit=$1 [L]

# answer a question RSS
RewriteRule ^voices/answers/rss/([^\/]+)/([0-9]+)\/?$ qa_answer_rss.php?questionId=$2
RewriteRule ^voices/answers/rss/([^\/]+)/([0-9]+)-(newquestions|recent|useful|oldest)?\/?$ qa_answer_rss.php?questionId=$2&sort=$3
RewriteRule ^voices/answers/rss\/? qa_answer_rss.php

# blog URLs
RewriteRule ^account/blog/? blog_manage_blog.php [L]
RewriteRule ^blog/post/?$ blog_edit_post.php
RewriteRule ^blog/edit/([0-9]+)/?$ blog_edit_post.php?postId=$1
RewriteRule ^blogs/?$ voices/blogs/ [L,R=301]
RewriteRule ^blog/rss/([^/]+)/(.+)$ blog_post_rss.php?blogSlug=$1&postSlug=$2
RewriteRule ^blog/rss/([^/]+)/$ blog_rss.php?blogSlug=$1
RewriteRule ^blog/([^/]+)/?$ blog_view_blog.php?blogSlug=$1 [QSA]
RewriteRule ^blog/([^/]+)/filter/([^/]+)/([^/]+)/([0-9]+)/?$ blog_view_blog.php?blogSlug=$1&filter=$2&filter_name=$3&filter_id=$4 [QSA]
RewriteRule ^blog/([^/]+)/(.+)$ blog_view_post.php?blogSlug=$1&postSlug=$2

# discussion URLs
RewriteRule ^discussion/[^\/-]*?-([^\/-])*?-([0-9]*)(-(recent|useful|oldest)?)?(-p_([0-9]+))?$ mvc_handler.php?dir=Voices&controller=DiscussionDetailPage&action=index&postSlug=$1&postId=$2&order=$4&page_number=$6

# guide URLs
RewriteRule ^guides/?$ voices/guides/ [L,R=301]
RewriteRule ^guides/([^/]+)/?$ guides_category.php?categorySlug=$1 [L]
RewriteRule ^guides/([^/]+)/([^/]+)/?$ guides_topic.php?categorySlug=$1&topicSlug=$2 [L]
RewriteRule ^guide/([^/]+)/([^/]+)/([^/]+)/?$ guide_view_post.php?categorySlug=$1&topicSlug=$2&postSlug=$3 [L]
#RewriteRule ^guide/([^/]+)/([^/]+)/([^/]+)/comments/p_([0-9]+)/?$ guide_view_post.php?categorySlug=$1&topicSlug=$2&postSlug=$3&comment_page=$4

#custom guides
RewriteRule ^guides-([^/]+)/?$ mvc_handler.php?dir=Guides&controller=Guide&action=index&package=$1 [L,QSA]
RewriteRule ^guides-([^/]+)/([^/]+)/?$ mvc_handler.php?dir=Guides&controller=Guide&action=category&package=$1&category=$2 [L,QSA]
RewriteRule ^guides-([^/]+)/([^/]+)/([^/]+)/?$ mvc_handler.php?dir=Guides&controller=Guide&action=topic&package=$1&category=$2&topic=$3 [L,QSA]
RewriteRule ^guides-([^/]+)/([^/]+)/([^/]+)/([^/]+)/?$ mvc_handler.php?dir=Guides&controller=Guide&action=guide&package=$1&category=$2&topic=$3&guide=$4 [L,QSA]

#crime maps - Redirect to Local Home
RewriteRule ^crime$ local/ [L,R=301]
RewriteRule ^crime/.*$ local/ [L,R=301]

# voices RSS
RewriteRule ^voices/rss$ voices/rss/ [L,R=301]

# email alerts
RewriteRule ^voices/alerts/?$ voices_email_alert_page.php [QSA,L]
RewriteRule ^alerts/search$ alerts/search/ [L,R=301]
RewriteRule ^alerts/search/.*$ search_email_alerts_page.php [L,QSA]

# Voices home page
RewriteRule ^voices$ voices/ [R=301,L]

# Old member search URLs
#RewriteRule ^real-estate-community.*$ voices/directory/ [R=301,L]
RewriteRule ^real-estate-community.*$ directory/ [R=301,L]

# Voices - Take care of missing trailing slashes
RewriteRule ^voices/blogs$ voices/blogs/ [L,R=301]
RewriteRule ^voices/discussions$ voices/discussions/ [L,R=301]
RewriteRule ^voices/qa$ voices/qa/ [L,R=301]
RewriteRule ^voices/guides$ voices/guides/ [L,R=301]

# Redirect old "Top Voices" to the Directory
RewriteRule ^voices/users/?$ directory/ [L,R=301]
RewriteRule ^voices/users/most_answers.*$ directory/-pros?sort_order=activity [L,R=301]
RewriteRule ^voices/users/most_liked_answers.*$ directory/-pros?sort_order=most_liked [L,R=301]
RewriteRule ^voices/users/best_answers.*$ directory/-pros?sort_order=best_answers [L,R=301]

# redirect old lhop urls
RewriteRule ^advice_opinions/?$ voices/  [R=301,L,QSA]
RewriteRule ^qa_home/?$ voices/qa/ [R=301,L,QSA]
RewriteRule ^blog_home/?$ voices/blogs/  [R=301,L,QSA]

RewriteRule ^voices/guides/?$ guides_home.php  [QSA,L]
RewriteRule ^voices/guides/[^\/-]+---([0-9]+)/?$ guides_home.php?locationId=$1 [QSA,L]

# What is VIP page
RewriteRule ^voices/what_is_vip/?$ what_is_vip.php [L]

#    prefix:                       ^voices/
# $1 rss:                          (?:(rss)/)?
# $2 filter:                        (?:(qa|blogs|guides|discussions|all)/)?
# $3 subfilter:                     (?:(activity|newest|oldest|best|popular|questions|answers|posts|comments|most_answers|most_liked_answers|best_answers|unanswered)\/?)?
#    location/category names (opt): [^\/-]*?-?[^\/-]*?
# $4 category ID:                   -?([0-9]*)
# $5 location ID:                   -?([0-9]*)
# $6 page no:                       -?(?:p_([0-9]+))?
# $7 keyword query:                 -*?/?(?:q_([^\/]+))?
#    optional trailing slash:       \/?$
# XXX: can we retired these filters? : 'best', 'questions', 'answers', 'posts', 'comments',
#      'most_answers', 'most_liked_answers', 'best_answers'
RewriteRule ^voices/(?:(rss)/)?(?:(qa|blogs|guides|discussions|all)/)?(?:(activity|newest|oldest|best|popular|questions|answers|posts|comments|most_answers|most_liked_answers|best_answers|unanswered)\/?)?[^\/-]*?-?[^\/-]*?-?([0-9]*)-?([0-9]*)-?(?:p_([0-9]+))?-*?/?(?:q_([^\/]+))?\/?$ mvc_handler.php?dir=Voices&controller=VoicesLocationPage&action=index&display_rss=$1&filter=$2&subfilter=$3&categoryId=$4&locationId=$5&page_number=$6&keyword=$7 [QSA,L]

# Voices "My Answers"
RewriteRule ^voices/my_answers/([0-9]+)(\.xml)?$ my_answers.php?user_id=$1
RewriteRule ^voices/my_answers/([0-9]+)-([0-9]+)(\.xml)?$ my_answers.php?user_id=$1&num=$2
RewriteRule ^voices/my_answers/([0-9]+)\.js$ my_answers.php?user_id=$1&output=js
RewriteRule ^voices/my_answers/([0-9]+)-([0-9]+)\.js$ my_answers.php?user_id=$1&output=js&num=$2
RewriteRule ^voices/my_answers/([0-9]+)-([0-9]+)-([0-9]+)-([a-z]+)\.js$ my_answers.php?user_id=$1&output=js&num=$2&widget_size=$3&widget_qa=$4

# answer a question processing
RewriteRule ^answer$ answer/
RewriteRule ^answer/$ mvc_handler.php?dir=Voices&controller=QuestionDetailPage&action=index
RewriteRule ^answer/([0-9]+)[^0-9]*$ mvc_handler.php?dir=Voices&controller=QuestionDetailPage&action=index&questionId=$1

# answer a question
RewriteRule ^voices/(answer/)?[^0-9][^/]+/.*-([0-9]+)-(?:p_([0-9]+))?-(newquestions|recent|useful|oldest)?$ mvc_handler.php?dir=Voices&controller=QuestionDetailPage&action=index&answer_open=$1&questionId=$2&page_number=$3&sort=$4 [QSA]
# answer a question, sort and page number missing
RewriteRule ^voices/(answer/)?[^0-9][^/]+/.*-([0-9]+)?$ mvc_handler.php?dir=Voices&controller=QuestionDetailPage&action=index&answer_open=$1&questionId=$2 [QSA]

# catch-all for /voices/ misses
RewriteRule ^voices/.+$ voices/ [R=301,L]

# end Voices

RewriteRule ^rss2$ rss2/
RewriteRule ^rss2/$ rss2/CA/San_Francisco/
RewriteRule ^rss2/\??(.*)$ rss.php?u=$1 [L,QSA]
# city guide
RewriteRule ^city/([^/]+)$ city/$1/
RewriteRule ^city/([^/]+)/([^/]+)$ city/$1/$2/
# city_guide.php takes care of the 301 redirect to the new city_guide_city
RewriteRule ^city/(.+)/([A-Z]{1})/ city_guide.php?state=$1&city_first=$2
RewriteRule ^city/(.+)/(.+)/$ city_guide.php?state=$1&city=$2
RewriteRule ^city/(.+)/$ city_guide.php?state=$1
RewriteRule ^city$ city/
RewriteRule ^city/$ city_guide.php

# local page
RewriteRule ^local/disclaimers/([a-z]+)/?$ mvc_handler.php?show_header=0&show_footer=0&dir=Basic&controller=Static&action=html&static_template=location_pages/$1_disclaimer.tpl [L]

RewriteRule ^local/? mvc_handler.php?dir=Location&controller=LocalHome&action=index [L,QSA]

# New Stats and Trends (City/Neighborhood) Guides
# www.trulia.com/real_estate/San_Francisco-California/

#stats and trends graph urls
RewriteRule ^real_estate/([A-Za-z0-9_\+\'%\ \,\(\)\.\-]+)-([^/]+)/([0-9]+)/graph.png?(.*)$ get_chart.php [L,QSA]
RewriteRule ^real_estate/([A-Za-z0-9_\+\'%\ \,\(\)\.\-]+)-([A-Za-z_]+)/graph.png?(.*)$ get_chart.php [L,QSA]
#remove below line next release 3-25-2009
RewriteRule ^tools/graphs/graph.png?(.*)$ get_chart.php [L,QSA]
RewriteRule ^tools/chart/graph.png?(.*)$ get_chart.php [L,QSA]

#zipcode version
RewriteRule ^real_estate/([0-9]+)-([A-Za-z0-9_\+\'%\ \,\(\)\.\-]+)/$ mvc_handler.php?dir=LocalPages&controller=LocalPagesOverview&action=index&zipcode=$1

RewriteRule ^real_estate/([0-9]+)-([A-Za-z0-9_\+\'%\ \,\(\)\.\-]+)/market-trends/$ mvc_handler.php?dir=LocalPages&controller=LocalPagesMarketTrends&action=index&zipcode=$1

RewriteRule ^real_estate/([0-9]+)-([A-Za-z0-9_\+\'%\ \,\(\)\.\-]+)/schools/$ mvc_handler.php?dir=LocalPages&controller=LocalPagesSchools&action=index&zipcode=$1

RewriteRule ^real_estate/([0-9]+)-([A-Za-z0-9_\+\'%\ \,\(\)\.\-]+)/community-info/$ mvc_handler.php?dir=LocalPages&controller=LocalPagesCommunityInfo&action=index&zipcode=$1

RewriteRule ^real_estate/([0-9]+)-([A-Za-z0-9_\+\'%\ \,\(\)\.\-]+)/crime/*$ mvc_handler.php?dir=LocalPages&controller=LocalPagesCrime&action=index&zipcode=$1 [L,QSA]

#neighborhood version
RewriteRule ^real_estate/([A-Za-z0-9_\+\'%\ \,\(\)\.\-]+)-([^/]+)/([0-9]+)/$ mvc_handler.php?dir=LocalPages&controller=LocalPagesOverview&action=index&neighborhood=$1&neighborhood_id=$3

RewriteRule ^real_estate/([A-Za-z0-9_\+\'%\ \,\(\)\.\-]+)-([^/]+)/([0-9]+)/market-trends/$ mvc_handler.php?dir=LocalPages&controller=LocalPagesMarketTrends&action=index&neighborhood=$1&neighborhood_id=$3

RewriteRule ^real_estate/([A-Za-z0-9_\+\'%\ \,\(\)\.\-]+)-([^/]+)/([0-9]+)/schools/$ mvc_handler.php?dir=LocalPages&controller=LocalPagesSchools&action=index&neighborhood=$1&neighborhood_id=$3

RewriteRule ^real_estate/([A-Za-z0-9_\+\'%\ \,\(\)\.\-]+)-([^/]+)/([0-9]+)/community-info/$ mvc_handler.php?dir=LocalPages&controller=LocalPagesCommunityInfo&action=index&neighborhood=$1&neighborhood_id=$3

RewriteRule ^real_estate/([A-Za-z0-9_\+\'%\ \,\(\)\.\-]+)-([^/]+)/([0-9]+)/crime/*$ mvc_handler.php?dir=LocalPages&controller=LocalPagesCrime&action=index&neighborhood=$1&neighborhood_id=$3 [L,QSA]

#city version
RewriteRule ^real_estate/([A-Za-z0-9_\+\'%\ \,\(\)\.\-]+)-([A-Za-z_]+)/*$ mvc_handler.php?dir=LocalPages&controller=LocalPagesOverview&action=index&state=$2&city=$1

RewriteRule ^real_estate/([A-Za-z0-9_\+\'%\ \,\(\)\.\-]+)-([A-Za-z_]+)/market-trends/*$ mvc_handler.php?dir=LocalPages&controller=LocalPagesMarketTrends&action=index&state=$2&city=$1

RewriteRule ^real_estate/([A-Za-z0-9_\+\'%\ \,\(\)\.\-]+)-([A-Za-z_]+)/schools/*$ mvc_handler.php?dir=LocalPages&controller=LocalPagesSchools&action=index&state=$2&city=$1

RewriteRule ^real_estate/([A-Za-z0-9_\+\'%\ \,\(\)\.\-]+)-([A-Za-z_]+)/community-info/*$ mvc_handler.php?dir=LocalPages&controller=LocalPagesCommunityInfo&action=index&state=$2&city=$1

RewriteRule ^real_estate/([A-Za-z0-9_\+\'%\ \,\(\)\.\-]+)-([A-Za-z_]+)/crime/*$ mvc_handler.php?dir=LocalPages&controller=LocalPagesCrime&action=index&state=$2&city=$1 [L,QSA]

#Sweepstakes
RewriteRule ^neighborhood-review-sweepstakes/?$ mvc_handler.php?dir=Sweepstakes&controller=Sweepstakes&action=index [L,QSA]

#Campaign Landing Page - Agent
RewriteRule ^agentmoment/?$ mvc_handler.php?dir=Campaign&controller=Campaign&action=agent [L,QSA]
RewriteRule ^moment/?$ mvc_handler.php?dir=Campaign&controller=Campaign&action=moment [L,QSA]

# heat map
# home_prices2/California/San_Francisco_heat_map
RewriteRule ^home_prices/([A-Za-z_-]+)$ home_prices/$1/
RewriteRule ^home_prices/([A-Za-z_-]+)/$ heat_map.php?state=$1
RewriteRule ^home_prices/([A-Za-z_-]+)/([-A-Za-z0-9_\+\'%\ \,\(\)\.]+)_(c|C)ounty-heat_?map/* heat_map.php?state=$1&county=$2
RewriteRule ^home_prices/([A-Za-z_-]+)/([-A-Za-z0-9_\+\'%\ \,\(\)\.]+)-heat_?map/([A-Za-z_]+)/([A-Za-z_]+)/([A-Za-z_]+)/* heat_map.php?state=$1&city=$2&view=$3&ob=$4&special=$5
RewriteRule ^home_prices/([A-Za-z_-]+)/([-A-Za-z0-9_\+\'%\ \,\(\)\.]+)-heat_?map/* heat_map.php?state=$1&city=$2
RewriteRule ^home_prices$ home_prices/
RewriteRule ^home_prices/ heat_map.php

# DO NOT REMOVE: THIS IS A GENERAL EXAMPLE OF DEALING WITH VARIABLE NUMBERS OF ARGUMENTS
#RewriteRule ^listing/([^/^_]+)_([^/^_]+)/(.*)$ listing/$3?$1=$2 [QSA,L]
#RewriteRule ^listing/$ dump_get_string.php [QSA,L]
# END DO NOT REMOVE

# School URLs
RewriteRule ^schools/([A-Za-z]{2})-([-A-Za-z0-9_\+\'%\ \,\(\)\.]+)/(.*)/?$ school_profile.php?state_code=$1&city=$2&school_name=$3 [QSA,L]
RewriteRule ^school-district/([A-Za-z]{2})-([-A-Za-z0-9_\+\'%\ \,\(\)\.]+)/(.*)/?$ school_district_profile.php?state_code=$1&county=$2&district_name=$3 [QSA,L]

############# RSS RULES #############
# rss links
# same query string as the results page
# rss2/CA/Palo_Alto/this_that/the_other/.....
# becomes
# rss.php?state=CA&city=Palo_Alto&this=that&the=other&...
RewriteRule ^rss2/([A-Za-z]{2})/([-A-Za-z0-9_\+\'%\ \,\(\)\.]+)/([^/]+)_([^/^_]+)/(.*)$ rss2/$1/$2/$5?$3=$4 [QSA,L]
RewriteRule ^rss2/([A-Za-z]{2})/([-A-Za-z0-9_\+\'%\ \,\(\)\.]+)/*$ rss.php?state=$1&city=$2 [QSA,L]
# rss2/CA/Palo_Alto/94301/this_that/the_other/.....
RewriteRule ^rss2/([A-Za-z]{2})/([-A-Za-z0-9_\+\'%\ \,\(\)\.]+)/([0-9]{5})/([^/]+)_([^/^_]+)/(.*)$ rss2/$1/$2/$3/$6?$4=$5 [QSA,L]
RewriteRule ^rss2/([A-Za-z]{2})/([-A-Za-z0-9_\+\'%\ \,\(\)\.]+)/([0-9]{5})/*$ rss.php?state=$1&city=$2&zip_code=$3 [QSA,L]
# no filters, just city and state
RewriteRule ^rss2/([A-Za-z]{2})/([-A-Za-z0-9_\+\'%\ \,\(\)\.]+)/*$ rss.php?state=$1&city=$2 [QSA,L]
# no filters, just city, state and zip
RewriteRule ^rss2/([A-Za-z]{2})/([-A-Za-z0-9_\+\'%\ \,\(\)\.]+)/([0-9]{5})/*$ rss.php?state=$1&city=$2&zip_code=$3 [QSA,L]
############# END RSS RULES #############

# RSS for City Guide
RewriteRule ^rss2/city/([A-Za-z]{2})/([-A-Za-z0-9_\+\'%\ \,\(\)\.]+)/*$ city_guide_rss.php?state=$1&city=$2 [QSA,L]
RewriteRule ^rss2/city/([A-Za-z]{2})/([-A-Za-z0-9_\+\'%\ \,\(\)\.]+)/([0-9]{5})/*$ rss.php?state=$1&city=$2&zip_code=$3 [QSA,L]

#####################################
##### Google Earth #####
RewriteRule ^kml2/(.*)$ - [G]

RewriteRule ^google_earth/(.*)$ - [G]

# Trulia Broker IQ product announcement for inman
RewriteRule ^iq/?$ http://truliaiq.kickofflabs.com [L,R=301]

############# RESULTS PAGE RULES #############
# rule to correct the missing neighborhood name sometimes (bug 2286)
# those urls look like: http://www.trulia.com/CA/San_Jose,1491,/
RewriteRule ^([A-Za-z]{2})/([-A-Za-z0-9_\+\'%\ \,\(\)\.]+),([0-9]+),/(.*)$ redirect301.php [QSA,L]

# CA/Palo_Alto/this_that/the_other/.....
# becomes
# results.php?state=CA&city=Palo_Alto&this=that&the=other&...
# first line fixes %20 found in place of underscores
RewriteRule ^([A-Za-z]{2})/(.*)[\ ](.*)/(.*)$ $1/$2_$3/$4 [L,R=301]

RewriteRule ^([A-Za-z]{2})/([-A-Za-z0-9_\+\'%\ \,\(\)\.]+)/([^/]+)_([^/^_]+)/(.*)$ $1/$2/$5?$3=$4 [QSA,L]

# SRP list view - canonical City/State & old-style URLs
RewriteRule ^([A-Za-z]{2})/([-A-Za-z0-9_\+\'%\ \,\(\)\.]+)/*$ mvc_handler.php?dir=SRP&controller=SRP&action=list&url=/for_sale/$2,$1/ [QSA,L]
RewriteRule ^([A-Za-z]{2})/([-A-Za-z0-9_\+\'%\ \,\(\)\.]+)/([0-9]{5})/([^/]+)_([^/^_]+)/(.*)$ $1/$2/$3/$6?$4=$5
RewriteRule ^([A-Za-z]{2})/([-A-Za-z0-9_\+\'%\ \,\(\)\.]+)/([0-9]{5})/*$ mvc_handler.php?dir=SRP&controller=SRP&action=list&url=/for_sale/$3_zip/ [QSA,L]

# SRP photo view
RewriteCond %{REQUEST_URI} /photo_v(/|$)
RewriteRule ^((sold|for_sale|assessor|classified|for_rent)/.+)$ mvc_handler.php?dir=SRP&controller=SRP&action=photos&url=/$1 [QSA,L]

# SRP map view
RewriteCond %{REQUEST_URI} /map_v(/|$)
RewriteRule ^((sold|for_sale|assessor|classified|for_rent)/.+)$ mvc_handler.php?dir=SRP&controller=SRP&action=map&url=/$1 [QSA,L]

# SRP list view
RewriteRule ^((sold|for_sale|assessor|classified|for_rent)/.+)$ mvc_handler.php?dir=SRP&controller=SRP&action=list&url=/$1 [QSA,L]

# Redirection for older URLs
RewriteRule ^assess/(.+)$ assessor/$1 [R=301,L]
RewriteRule ^assessor/(.+),([^/]+)/?$ $2/$1/ [R=301,L]
RewriteRule ^sold/sold/(.+)$ sold/$1 [R=301,L]

############# END RESULTS PAGE RULES #############

# just state? go to site map
# this is for folks who play around with URLs
RewriteRule ^([A-Za-z]{2})/*$ map.php?stateCode=$1

# QR CODES
RewriteRule qr_img.gif qr_img.php

# PR URL for Michael Corbett's blog
RewriteRule ^MichaelCorbett/?$ blog/michaelcorbett/ [NC,R=301,L]

# Acton Marketing page - BSRR-1214
RewriteRule ^remax/*$ http://agent.trulia.com/acton/media/2844/remax [L,R=301]

# Acton Marketing page - BSAE-2000
RewriteRule ^betterhomes/*$ http://agent.trulia.com/acton/fs/blocks/showLandingPage/a/2844/p/p-00a8/t/page/fm/0 [L,R=301]

# Acton Marketing page - BSLR-270
RewriteRule ^smartphone/*$ http://agent.trulia.com/acton/media/2844/android-promo [L,R=301]

# Trulia Partner Program - FE-11408
RewriteRule ^truliapartnerprogram/?$ http://agent.trulia.com/acton/fs/blocks/showLandingPage/a/2844/p/p-0037/t/page/fm/0 [L,R=301]

# Broker Resource Library  - BSAE-2241
RewriteRule ^resourcelibrary/?$ http://agent.trulia.com/acton/fs/blocks/showLandingPage/a/2844/p/p-0100/t/page/fm/0 [L,R=301]

# Berkshire Hathaway Partnership Redirect - BSAE-3220
RewriteRule ^bhhs/? http://agent.trulia.com/acton/fs/blocks/showLandingPage/a/2844/p/p-0189/t/page/fm/0 [L,R=301]
RewriteRule ^prea/? http://agent.trulia.com/acton/fs/blocks/showLandingPage/a/2844/p/p-018a/t/page/fm/0 [L,R=301]

# Holiday Sweepstakes URLs - BSAE-3243
RewriteRule ^agentholidaysweeps/? http://agent.trulia.com/acton/fs/blocks/showLandingPage/a/2844/p/p-0184/t/page/fm/0
RewriteRule ^brokerholidaysweeps/? http://agent.trulia.com/acton/fs/blocks/showLandingPage/a/2844/p/p-0186/t/page/fm/0

# Lead quality sweepstakes BSRR-1845
RewriteRule ^lead-sweepstakes/?$ mvc_handler.php?dir=BusinessServices/LeadQualitySweepstakes&controller=LeadQualitySweepstakes [L,QSA]
RewriteRule ^lead-sweepstakes/rate/?$ mvc_handler.php?dir=BusinessServices/LeadQualitySweepstakes&controller=LeadQualitySweepstakes&action=rate [L,QSA]

#Rewrite recaptcha ajax urls to stemplate equivalent
RewriteRule ^recaptcha/$ mvc_handler.php?show_header=0&show_footer=0&dir=Basic&controller=Static&action=html&static_template=recaptcha/recaptchaAjax.tpl

# Experian Template
RewriteRule ^experian$ experian/ [NC,R=301,L]
RewriteRule ^experian/$ mvc_handler.php?dir=Campaign&controller=Partner&action=experian [L]

# 2014-05 Sweepstakes
RewriteRule ^win/?$ http://win.trulia.com/?ecampaign=sweeps_tv [R=301,L,NC]

# Redirect all bad URLs to the sitemap
RewriteCond $1 '!=images' [NC]
RewriteCond $1 '!=pictures' [NC]
RewriteCond $1 '!=server-status' [NC]
RewriteRule ^([-A-Za-z_\+\'%\ ]+)/*$ map.php?state=$1

# if we want to replace transfer.php?t=redirecturl
# with t/redirecturl
#RewriteRule ^t/(.*)$ transfer.php?t=$1

# PDFs
RewriteRule ^resources/([^\.]+\.pdf)$ http://images.trulia.com/resources/$1 [L,R=301]
RewriteRule ^resources/labs/([^\.]+\.zip)$ http://images.trulia.com/resources/labs/$1 [L,R=301]

#FLASH
RewriteRule ^agent_featured_listings.html$ http://images.trulia.com/images/swf_files/screencast/agent_featured_listings/index.html [L,R=301]

#TYPO IN STUFF THAT WENT TO 1000 AGENTS
RewriteRule ^MyTrulia/?$ mytrulia [R=301,L]
RewriteRule ^mytrulia\.$ mytrulia/ [R=301,L]

# Redirect PR links to explore.trulia.com
# Note: at some point, we'll migrate the static pages from explore.trulia.com (Movity's server) to www.trulia.com.
# When we do, any link to explore.trulia.com/explore/* will then redirect to www.trulia.com directly, the opposite of what this rule does.
RewriteRule ^datavis/(.*)$ http://explore.trulia.com/datavis/$1 [R=301,L]

#Rewrite foreseee survey urls to stemplate equivalent
RewriteRule ^foresee/(.+)\.html$ mvc_handler.php?show_header=0&show_footer=0&dir=Basic&controller=Static&action=html&static_template=foresee_survey/$1.tpl

# Checkin Sweepstakes
RewriteRule ^check-in/sweeps/confirm/?$ mvc_handler.php?dir=Checkin&controller=CheckinSweepsReferral&action=referral&success=1 [L,QSA]
RewriteRule ^check-in/sweeps/(.*)/?$ mvc_handler.php?dir=Checkin&controller=CheckinSweepsReferral&action=referral&referral=$1 [L,QSA]
RewriteRule ^check-in/sweeps/?$ mvc_handler.php?dir=Checkin&controller=CheckinSweepsReferral&action=referral [L,QSA]

#BSAE-2098
RewriteRule ^listhub/help/?$ http://agent.trulia.com/acton/fs/blocks/showLandingPage/a/2844/p/p-00f6/t/page/fm/0 [L,QSA]

#Consumer Followup
RewriteRule ^consumer-followup/yes/([0-9]+)/?$ mvc_handler.php?dir=ConsumerFollowup&controller=ConsumerFollowup&action=was_responded_to&consumer_followup_id=$1 [L,QSA]
RewriteRule ^consumer-followup/no/([0-9]+)/?$ mvc_handler.php?dir=ConsumerFollowup&controller=ConsumerFollowup&action=was_not_responded_to&consumer_followup_id=$1 [L,QSA]
RewriteRule ^consumer-followup/thanks/?$ mvc_handler.php?dir=ConsumerFollowup&controller=ConsumerFollowup&action=thanks [L,QSA]
RewriteRule ^consumer-followup/thanks-resend/?$ mvc_handler.php?dir=ConsumerFollowup&controller=ConsumerFollowup&action=thanks_resend [L,QSA]
RewriteRule ^consumer-followup/unsubscribe/([0-9]+)/?$ mvc_handler.php?dir=ConsumerFollowup&controller=ConsumerFollowup&action=unsubscribe_consumer&consumer_followup_id=$1 [L,QSA]

